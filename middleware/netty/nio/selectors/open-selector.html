<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OpenSelector | 天道酬勤。</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.5.1/katex.min.css">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    <meta name="description" content="天道酬勤">
    
    <link rel="preload" href="/assets/css/0.styles.cd5033e5.css" as="style"><link rel="preload" href="/assets/js/app.7acd518c.js" as="script"><link rel="preload" href="/assets/js/2.420b8cff.js" as="script"><link rel="preload" href="/assets/js/46.2549a636.js" as="script"><link rel="prefetch" href="/assets/js/10.93a502fa.js"><link rel="prefetch" href="/assets/js/100.e337dfdb.js"><link rel="prefetch" href="/assets/js/101.018cf288.js"><link rel="prefetch" href="/assets/js/102.3d4623a0.js"><link rel="prefetch" href="/assets/js/103.af81d266.js"><link rel="prefetch" href="/assets/js/104.741e9da8.js"><link rel="prefetch" href="/assets/js/105.b5a7ed79.js"><link rel="prefetch" href="/assets/js/106.ab7033a3.js"><link rel="prefetch" href="/assets/js/107.f9e0651b.js"><link rel="prefetch" href="/assets/js/108.df3512ed.js"><link rel="prefetch" href="/assets/js/109.2586e22e.js"><link rel="prefetch" href="/assets/js/11.15a01eac.js"><link rel="prefetch" href="/assets/js/110.1244369d.js"><link rel="prefetch" href="/assets/js/111.23df1dcf.js"><link rel="prefetch" href="/assets/js/112.15053e34.js"><link rel="prefetch" href="/assets/js/113.2ab4be63.js"><link rel="prefetch" href="/assets/js/114.bc52206d.js"><link rel="prefetch" href="/assets/js/115.55cce93e.js"><link rel="prefetch" href="/assets/js/116.4415f6bc.js"><link rel="prefetch" href="/assets/js/117.40b2fa00.js"><link rel="prefetch" href="/assets/js/118.651e15a9.js"><link rel="prefetch" href="/assets/js/119.81693220.js"><link rel="prefetch" href="/assets/js/12.94daea0c.js"><link rel="prefetch" href="/assets/js/13.8bc08bbf.js"><link rel="prefetch" href="/assets/js/14.e75ba77a.js"><link rel="prefetch" href="/assets/js/15.542a8d34.js"><link rel="prefetch" href="/assets/js/16.59e476b5.js"><link rel="prefetch" href="/assets/js/17.d1ccb9b3.js"><link rel="prefetch" href="/assets/js/18.d6bb974a.js"><link rel="prefetch" href="/assets/js/19.d7f57063.js"><link rel="prefetch" href="/assets/js/20.15d74344.js"><link rel="prefetch" href="/assets/js/21.b66a54be.js"><link rel="prefetch" href="/assets/js/22.f62ed9cd.js"><link rel="prefetch" href="/assets/js/23.ba1d9b15.js"><link rel="prefetch" href="/assets/js/24.a08baccd.js"><link rel="prefetch" href="/assets/js/25.7e4bb10c.js"><link rel="prefetch" href="/assets/js/26.a04e2cef.js"><link rel="prefetch" href="/assets/js/27.f503ab8b.js"><link rel="prefetch" href="/assets/js/28.baa875d9.js"><link rel="prefetch" href="/assets/js/29.13f34a45.js"><link rel="prefetch" href="/assets/js/3.4c5e245d.js"><link rel="prefetch" href="/assets/js/30.a9ac693b.js"><link rel="prefetch" href="/assets/js/31.dcf74d9c.js"><link rel="prefetch" href="/assets/js/32.79639a38.js"><link rel="prefetch" href="/assets/js/33.7258ae50.js"><link rel="prefetch" href="/assets/js/34.6b311830.js"><link rel="prefetch" href="/assets/js/35.11e0760b.js"><link rel="prefetch" href="/assets/js/36.71d6a108.js"><link rel="prefetch" href="/assets/js/37.b67a3038.js"><link rel="prefetch" href="/assets/js/38.48c5a8b2.js"><link rel="prefetch" href="/assets/js/39.26d3c2c8.js"><link rel="prefetch" href="/assets/js/4.0297cc61.js"><link rel="prefetch" href="/assets/js/40.fe258231.js"><link rel="prefetch" href="/assets/js/41.b85faa4a.js"><link rel="prefetch" href="/assets/js/42.4dcd66f5.js"><link rel="prefetch" href="/assets/js/43.a2c7dfc2.js"><link rel="prefetch" href="/assets/js/44.26d753ba.js"><link rel="prefetch" href="/assets/js/45.ee1ec470.js"><link rel="prefetch" href="/assets/js/47.2093fcb0.js"><link rel="prefetch" href="/assets/js/48.0d7d61dd.js"><link rel="prefetch" href="/assets/js/49.16c4c40b.js"><link rel="prefetch" href="/assets/js/5.25ad0a62.js"><link rel="prefetch" href="/assets/js/50.99abec20.js"><link rel="prefetch" href="/assets/js/51.c6733b93.js"><link rel="prefetch" href="/assets/js/52.67111675.js"><link rel="prefetch" href="/assets/js/53.d102868e.js"><link rel="prefetch" href="/assets/js/54.52d99244.js"><link rel="prefetch" href="/assets/js/55.ebe0879b.js"><link rel="prefetch" href="/assets/js/56.01396813.js"><link rel="prefetch" href="/assets/js/57.e1b9d4ae.js"><link rel="prefetch" href="/assets/js/58.d7ea439b.js"><link rel="prefetch" href="/assets/js/59.72cab26f.js"><link rel="prefetch" href="/assets/js/6.5d06e587.js"><link rel="prefetch" href="/assets/js/60.7729225b.js"><link rel="prefetch" href="/assets/js/61.02837053.js"><link rel="prefetch" href="/assets/js/62.9eef335b.js"><link rel="prefetch" href="/assets/js/63.5ac4a5b1.js"><link rel="prefetch" href="/assets/js/64.a9482ea5.js"><link rel="prefetch" href="/assets/js/65.596f3870.js"><link rel="prefetch" href="/assets/js/66.12cac1a9.js"><link rel="prefetch" href="/assets/js/67.4d4f30ed.js"><link rel="prefetch" href="/assets/js/68.23805050.js"><link rel="prefetch" href="/assets/js/69.0d01d649.js"><link rel="prefetch" href="/assets/js/7.c59e0351.js"><link rel="prefetch" href="/assets/js/70.4bb3f6fa.js"><link rel="prefetch" href="/assets/js/71.9b510cec.js"><link rel="prefetch" href="/assets/js/72.a5a2c5cd.js"><link rel="prefetch" href="/assets/js/73.0194d901.js"><link rel="prefetch" href="/assets/js/74.7d7f12c2.js"><link rel="prefetch" href="/assets/js/75.dcc753d3.js"><link rel="prefetch" href="/assets/js/76.5ac2a1de.js"><link rel="prefetch" href="/assets/js/77.5ec8f887.js"><link rel="prefetch" href="/assets/js/78.60056838.js"><link rel="prefetch" href="/assets/js/79.6de61e79.js"><link rel="prefetch" href="/assets/js/8.fb2bdcd2.js"><link rel="prefetch" href="/assets/js/80.075aee8e.js"><link rel="prefetch" href="/assets/js/81.4b6c2662.js"><link rel="prefetch" href="/assets/js/82.edb5c5c0.js"><link rel="prefetch" href="/assets/js/83.0230a389.js"><link rel="prefetch" href="/assets/js/84.5366d192.js"><link rel="prefetch" href="/assets/js/85.8623e3f8.js"><link rel="prefetch" href="/assets/js/86.52d9cbf3.js"><link rel="prefetch" href="/assets/js/87.4aae137b.js"><link rel="prefetch" href="/assets/js/88.2f13d134.js"><link rel="prefetch" href="/assets/js/89.cb243c40.js"><link rel="prefetch" href="/assets/js/9.04e27b8a.js"><link rel="prefetch" href="/assets/js/90.cc86ca21.js"><link rel="prefetch" href="/assets/js/91.8232dc99.js"><link rel="prefetch" href="/assets/js/92.bd8150b0.js"><link rel="prefetch" href="/assets/js/93.a953f7ea.js"><link rel="prefetch" href="/assets/js/94.0a69171b.js"><link rel="prefetch" href="/assets/js/95.afc1608a.js"><link rel="prefetch" href="/assets/js/96.27ea6cc9.js"><link rel="prefetch" href="/assets/js/97.da711f53.js"><link rel="prefetch" href="/assets/js/98.3621ef18.js"><link rel="prefetch" href="/assets/js/99.e7698df5.js">
    <link rel="stylesheet" href="/assets/css/0.styles.cd5033e5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">天道酬勤。</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><a href="/introduction/" class="sidebar-link">前言</a></li><li><section class="sidebar-group depth-0"><a href="/middleware/" class="sidebar-heading clickable router-link-active open"><span>中间件</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/middleware/netty/" class="sidebar-heading clickable router-link-active open"><span>Netty</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-2"><a href="/middleware/netty/knowledge/" class="sidebar-heading clickable"><span>基础知识</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/middleware/netty/knowledge/reference.html" class="sidebar-link">参考资料</a></li><li><a href="/middleware/netty/knowledge/read-source.html" class="sidebar-link">如何读源码</a></li><li><a href="/middleware/netty/knowledge/quick-start.html" class="sidebar-link">快速上手</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>Reactor</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/middleware/netty/reactor/single.html" class="sidebar-link">Single</a></li><li><a href="/middleware/netty/reactor/multiple.html" class="sidebar-link">Multiple</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>EventLoop</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/middleware/netty/nio/event-loop/nio-event-loop-group.html" class="sidebar-link">EventLoopGroup</a></li><li><a href="/middleware/netty/nio/event-loop/nio-event-loop.html" class="sidebar-link">EventLoop</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><a href="/middleware/netty/nio/selectors/selector" class="sidebar-heading clickable open"><span>Selectors</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/middleware/netty/nio/selectors/open-selector.html" aria-current="page" class="active sidebar-link">OpenSelector</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/middleware/netty/nio/selectors/thread-factory.html" class="sidebar-link">DefaultThreadFactory</a></li><li><a href="/middleware/netty/nio/selectors/chooser-factory.html" class="sidebar-link">ChooserFactory</a></li></ul></section></li><li><a href="/middleware/netty/nio/bootstrap/bootstrap.html" class="sidebar-link">Bootstrap</a></li><li><section class="sidebar-group is-sub-group depth-2"><a href="/middleware/netty/nio/channels/channel" class="sidebar-heading clickable"><span>Channel</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/middleware/netty/nio/channels/channel-init.html" class="sidebar-link">Channel-Init</a></li><li><a href="/middleware/netty/nio/channels/channel-register.html" class="sidebar-link">Channel-register</a></li><li><a href="/middleware/netty/nio/channels/channel-handler.html" class="sidebar-link">Channel-handler</a></li><li><a href="/middleware/netty/nio/channels/channel-bind.html" class="sidebar-link">Channel-bind</a></li><li><a href="/middleware/netty/nio/channels/channel-unsafe.html" class="sidebar-link">Channel-Unsafe</a></li><li><a href="/middleware/netty/nio/channels/channel-pipeline.html" class="sidebar-link">Channel-Pipeline</a></li></ul></section></li><li><a href="/middleware/netty/nio/codec/codec.html" class="sidebar-link">Codec</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>编程语言</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>Java</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading open"><span>虚拟机</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-3"><a href="/languages/java/jvm/layout/run-time-data-areas" class="sidebar-heading clickable open"><span>内存布局</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/languages/java/jvm/layout/pc-register.html" class="sidebar-link">Pc Register</a></li><li><a href="/languages/java/jvm/layout/stacks.html" class="sidebar-link">Stacks</a></li><li><a href="/languages/java/jvm/layout/Frames.html" class="sidebar-link">Frames</a></li><li><a href="/languages/java/jvm/layout/share-data.html" class="sidebar-link">共享数据</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-3"><p class="sidebar-heading"><span>垃圾回收器</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/languages/java/jvm/jvm-select.html" class="sidebar-link">jvm-select</a></li><li><a href="/languages/java/jvm/SerialHeap.html" class="sidebar-link">SerialHeap</a></li><li><a href="/languages/java/jvm/safepoint.html" class="sidebar-link">safepoint</a></li><li><a href="/languages/java/jvm/jvm-select-use.html" class="sidebar-link">生产使用</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><a href="/languages/java/thread/java/juc/read-me" class="sidebar-heading clickable"><span>多线程编程</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-3"><p class="sidebar-heading open"><span>基础知识</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/languages/java/thread/java/juc/aos.html" class="sidebar-link">exclusively</a></li><li><a href="/languages/java/thread/java/juc/atomic.html" class="sidebar-link">cas</a></li><li><a href="/languages/java/thread/java/juc/aqs.html" class="sidebar-link">aqs</a></li><li><a href="/languages/java/thread/java/juc/blocking.html" class="sidebar-link">LockSupport</a></li><li><a href="/languages/java/thread/java/juc/clh.html" class="sidebar-link">clh锁</a></li><li><a href="/languages/java/thread/java/juc/condition.html" class="sidebar-link">Condition</a></li><li><a href="/languages/java/thread/java/juc/future.html" class="sidebar-link">FutureTask</a></li><li><a href="/languages/java/thread/java/juc/daemon.html" class="sidebar-link">daemon</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-3"><p class="sidebar-heading"><span>应用</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/languages/java/thread/java/juc/thread-factory.html" class="sidebar-link">ThreadFactory</a></li><li><a href="/languages/java/thread/java/juc/rejected-execution-handler.html" class="sidebar-link">ExecutionPolicy</a></li><li><a href="/languages/java/thread/java/juc/work.html" class="sidebar-link">Worker</a></li><li><a href="/languages/java/thread/java/juc/thread-pool-executor.html" class="sidebar-link">ThreadPoolExecutor</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/languages/java/auto-box.html" class="sidebar-link">自动装箱</a></li><li><a href="/languages/java/delay-queue.html" class="sidebar-link">锁局部变量</a></li><li><a href="/languages/java/introduction-to-java-bytecode.html" class="sidebar-link">基于栈的指令集</a></li><li><a href="/languages/java/heap-java.html" class="sidebar-link">Heap源码</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>go</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/languages/go/heap-go.html" class="sidebar-link">Heap源码</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>基本功</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/basic-skill/algorithms" class="sidebar-heading clickable open"><span>算法</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-2"><a href="/basic-skill/algorithms/sort/sort" class="sidebar-heading clickable open"><span>排序</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic-skill/algorithms/sort/bubble-sort.html" class="sidebar-link">冒泡排序</a></li><li><a href="/basic-skill/algorithms/sort/select-sort.html" class="sidebar-link">选择排序</a></li><li><a href="/basic-skill/algorithms/sort/insert-sort.html" class="sidebar-link">插入排序</a></li><li><a href="/basic-skill/algorithms/sort/merge-sort.html" class="sidebar-link">归并排序</a></li><li><a href="/basic-skill/algorithms/sort/quick-sort.html" class="sidebar-link">快速排序</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>数据结构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic-skill/algorithms/structure/union-find-structure.html" class="sidebar-link">并查集</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><a href="/basic-skill/algorithms/tree/binary-tree-concept" class="sidebar-heading clickable"><span>Tree</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic-skill/algorithms/tree/pre-order.html" class="sidebar-link">前序遍历</a></li><li><a href="/basic-skill/algorithms/tree/binary-tree-algs4.html" class="sidebar-link">二叉树-算法4</a></li><li><a href="/basic-skill/algorithms/tree/balanced-search-trees.html" class="sidebar-link">2-3-搜索树</a></li><li><a href="/basic-skill/algorithms/heap/heap.html" class="sidebar-link">Heap</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><a href="/basic-skill/algorithms/graphs/" class="sidebar-heading clickable"><span>图</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic-skill/algorithms/graphs/graph-concept.html" class="sidebar-link">概念</a></li><li><a href="/basic-skill/algorithms/graphs/directed-graph.html" class="sidebar-link">有向图</a></li><li><a href="/basic-skill/algorithms/graphs/graph-search.html" class="sidebar-link">搜索</a></li><li><a href="/basic-skill/algorithms/graphs/minimum-spanning-tree.html" class="sidebar-link">最小生成树</a></li><li><a href="/basic-skill/algorithms/graphs/shortest-path-algnorithms.html" class="sidebar-link">最短路径算法</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading"><span>其他</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic-skill/algorithms/other/Edsger-Dijkstra.html" class="sidebar-link">荷兰国旗</a></li><li><a href="/basic-skill/algorithms/other/binary-Search.html" class="sidebar-link">二分查找法</a></li><li><a href="/basic-skill/algorithms/other/swap-or-exchange.html" class="sidebar-link">交换还是移动？</a></li><li><a href="/basic-skill/algorithms/other/xor.html" class="sidebar-link">Xor</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/basic-skill/design-pattern/" class="sidebar-heading clickable"><span>设计模式</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-2"><p class="sidebar-heading open"><span>policy</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic-skill/design-pattern/policy/spring-error-demo.html" class="sidebar-link">spring-error-demo</a></li><li><a href="/basic-skill/design-pattern/policy/spring-policy.html" class="sidebar-link">spring-policy</a></li><li><a href="/basic-skill/design-pattern/policy/spring-fly-weight.html" class="sidebar-link">spring-flyweight-policy</a></li></ul></section></li><li><a href="/basic-skill/design-pattern/interpreter/interpreter-pattern.html" class="sidebar-link">interpreter</a></li><li><section class="sidebar-group is-sub-group depth-2"><a href="/basic-skill/design-pattern/structure/decorator/concept" class="sidebar-heading clickable"><span>decorator</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic-skill/design-pattern/structure/decorator/decorator-java.html" class="sidebar-link">Decorator-Java</a></li><li><a href="/basic-skill/design-pattern/structure/decorator/decorator-netty.html" class="sidebar-link">Decorator-Netty</a></li><li><a href="/basic-skill/design-pattern/structure/decorator/decorator-hystrix.html" class="sidebar-link">Decorator-Hystrix</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/framework/" class="sidebar-heading clickable"><span>框架</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-2"><a href="/framework/spring/" class="sidebar-heading clickable open"><span>Spring</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/framework/spring/di-concept.html" class="sidebar-link">DI概念</a></li><li><a href="/framework/spring/di.html" class="sidebar-link">DI实现</a></li><li><a href="/framework/spring/initialize-bean.html" class="sidebar-link">扩展点</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>计算机网络</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/basic-skill/network/tree-shake-hands.html" class="sidebar-link">三次握手</a></li><li><a href="/basic-skill/network/four-wave.html" class="sidebar-link">四次挥手</a></li></ul></section></li></ul></section></li><li><a href="/linked/" class="sidebar-link">常用网站</a></li><li><section class="sidebar-group depth-0"><a href="/lh2209/" class="sidebar-heading clickable"><span>lh2209</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/lh2209/lh2209-05-27.html" class="sidebar-link">lh2209-05-27</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="openselector">OpenSelector</h1> <h3 id="动机">动机</h3> <p>3ce9ab2e Trustin Lee <a href="mailto:t@motd.kr">t@motd.kr</a> on 2013/6/10 at 11:00 下午<br>
Replace the sun.nio.ch. SelectorImpl.selectedKeys with faster one<br>
替换 SelectorImpl.selectedKeys 使用更快的方式<br></p> <ul><li>Yield much less garbage<br>
更少的垃圾回收<br></li> <li>Slight performance gain (1~2%)<br>
性能略有提高<br>
SelectorImpl 基础代码</li></ul> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">SelectorImpl</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSelector</span> <span class="token punctuation">{</span>
    <span class="token keyword">protected</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> selectedKeys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token class-name">HashSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> keys <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashSet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> publicKeys<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">Set</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> publicSelectedKeys<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>底层:</p> <p><img src="/assets/img/hashmap-select.b3097aee.jpg" alt="An image"></p> <p>当我看 <code>openSelector</code> 这个方法时候，我发现这里这么一大段代码， 只是感觉感觉这里写的很妙，但是完全很茫然，等我看到动机后，就完全明白了。</p> <h3 id="原始代码">原始代码</h3> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token keyword">private</span> <span class="token class-name">Selector</span> <span class="token function">openSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> provider<span class="token punctuation">.</span><span class="token function">openSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ChannelException</span><span class="token punctuation">(</span><span class="token string">&quot;failed to open a new selector&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</code></pre></div><p>优化前的代码是不是很简单，直接创建了一个选择器，我们写 demo 时候也会这么写。</p> <h3 id="优化提交的代码">优化提交的代码</h3> <div class="language-java extra-class"><pre class="language-java"><code>  <span class="token comment">// 判断是否打开了优化</span>
  <span class="token keyword">private</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">boolean</span> DISABLE_KEYSET_OPTIMIZATION <span class="token operator">=</span>
            <span class="token class-name">SystemPropertyUtil</span><span class="token punctuation">.</span><span class="token function">getBoolean</span><span class="token punctuation">(</span><span class="token string">&quot;io.netty.noKeySetOptimization&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token keyword">private</span> <span class="token class-name">Selector</span> <span class="token function">openSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">final</span> <span class="token class-name">Selector</span> selector<span class="token punctuation">;</span>
        <span class="token keyword">try</span> <span class="token punctuation">{</span>
            selector <span class="token operator">=</span> provider<span class="token punctuation">.</span><span class="token function">openSelector</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">ChannelException</span><span class="token punctuation">(</span><span class="token string">&quot;failed to open a new selector&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// 如果没有优化直接返回</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>DISABLE_KEYSET_OPTIMIZATION<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">return</span> selector<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">try</span> <span class="token punctuation">{</span>

            <span class="token comment">// 数组的set结果</span>
            <span class="token class-name">SelectedSelectionKeySet</span> selectedKeySet <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SelectedSelectionKeySet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> selectorImplClass <span class="token operator">=</span>
                    <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span><span class="token string">&quot;sun.nio.ch.SelectorImpl&quot;</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token class-name">ClassLoader</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            selectorImplClass<span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>selector<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 反射</span>
            <span class="token class-name">Field</span> selectedKeysField <span class="token operator">=</span> selectorImplClass<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;selectedKeys&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Field</span> publicSelectedKeysField <span class="token operator">=</span> selectorImplClass<span class="token punctuation">.</span><span class="token function">getDeclaredField</span><span class="token punctuation">(</span><span class="token string">&quot;publicSelectedKeys&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            selectedKeysField<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            publicSelectedKeysField<span class="token punctuation">.</span><span class="token function">setAccessible</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token comment">// 反射替换值</span>
            selectedKeysField<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> selectedKeySet<span class="token punctuation">)</span><span class="token punctuation">;</span>
            publicSelectedKeysField<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span>selector<span class="token punctuation">,</span> selectedKeySet<span class="token punctuation">)</span><span class="token punctuation">;</span>

            selectedKeys <span class="token operator">=</span> selectedKeySet<span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Instrumented an optimized java.util.Set into: {}&quot;</span><span class="token punctuation">,</span> selector<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> t<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            selectedKeys <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            logger<span class="token punctuation">.</span><span class="token function">trace</span><span class="token punctuation">(</span><span class="token string">&quot;Failed to instrument an optimized java.util.Set into: {}&quot;</span><span class="token punctuation">,</span> selector<span class="token punctuation">,</span> t<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> selector<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">SelectedSelectionKeySet</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractSet</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">SelectionKey</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keysA<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> keysASize<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token class-name">SelectionKey</span><span class="token punctuation">[</span><span class="token punctuation">]</span> keysB<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">int</span> keysBSize<span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token keyword">boolean</span> isA <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre></div><h3 id="优化理论">优化理论</h3> <p>替换 hashset 为数组，因为数组支持基地址+偏移地址进行遍历，节省更多空间，遍历更快。可参考<a href="https://book.douban.com/subject/26912767/" target="_blank" rel="noopener noreferrer">深入理解计算机系统（原书第 3 版）<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> ( 3.8 数组分配和访问 - 3.9 异质的数据结构)</p> <p>java 中的应用 <code>RandomAccess</code> 其中有一段注释为</p> <div class="language-java extra-class"><pre class="language-java"><code>     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">,</span> n<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i <span class="token operator">&amp;</span>lt<span class="token punctuation">;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
         list<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>

     runs faster than <span class="token keyword">this</span> loop<span class="token operator">:</span>

     <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Iterator</span> i<span class="token operator">=</span>list<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> i<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span>
</code></pre></div><h3 id="代码权限">代码权限</h3> <div class="language-java extra-class"><pre class="language-java"><code>   <span class="token class-name">Object</span> maybeSelectorImplClass <span class="token operator">=</span> <span class="token class-name">AccessController</span><span class="token punctuation">.</span><span class="token function">doPrivileged</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">PrivilegedAction</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> <span class="token class-name">Class</span><span class="token punctuation">.</span><span class="token function">forName</span><span class="token punctuation">(</span>
                            <span class="token string">&quot;sun.nio.ch.SelectorImpl&quot;</span><span class="token punctuation">,</span>
                            <span class="token boolean">false</span><span class="token punctuation">,</span>
                            <span class="token class-name">PlatformDependent</span><span class="token punctuation">.</span><span class="token function">getSystemClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Throwable</span> cause<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">return</span> cause<span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>这段代码主要是关于代码权限的问题，比如 B 系统没有 C 文件夹写的权限，但是 A 有 C 文件夹写的权限，B 系统委托给 A 系统调用，使用 <code>AccessController.doPrivileged</code> 可以解决权限链向上检查问题，从 A 系统有权限就终止了，想深入了解请自行查找资料。</p> <h3 id="版本优化">版本优化</h3> <p>支持 JDK9 及以上版本<br>
动机：在 JDK8 使用反射替换 <code>key set</code> ，在 JDK9 以后在域反射使用 <code>setAccessible(true)</code> 不在生效。<br></p> <p>NioEventLoop should also use our special SelectionKeySet on Java9 and later. (#8260)<br>
Motivation: In Java8 and earlier we used reflection to replace the used key set if not otherwise told. This does not work on Java9 and later without special flags as its not possible to call setAccessible(true) on the Field anymore.
Modifications: - Use Unsafe to instrument the Selector with out special set when sun.misc. Unsafe is present and we are using Java9+.
Result: NIO transport produce less GC on Java9 and later as well.</p> <div class="language-java extra-class"><pre class="language-java"><code>   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">PlatformDependent</span><span class="token punctuation">.</span><span class="token function">javaVersion</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;=</span> <span class="token number">9</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">PlatformDependent</span><span class="token punctuation">.</span><span class="token function">hasUnsafe</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

   <span class="token punctuation">}</span>
</code></pre></div><h3 id="selectortuple">SelectorTuple</h3> <p>持续优化带来的产物</p> <ul><li><a href="https://github.com/netty/netty/issues/6058" target="_blank" rel="noopener noreferrer">Use a single array in SelectedSelectionKeySet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li><a href="https://github.com/netty/netty/issues/6607" target="_blank" rel="noopener noreferrer">NioEventLoop#rebuildSelector0 throws ClassCastException<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h3 id="总结">总结</h3> <p>减少复杂度学习源码复杂度，可以在 debug 代码时候可以回归到原始状态。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/middleware/netty/nio/event-loop/nio-event-loop.html" class="prev">
        EventLoop
      </a></span> <span class="next"><a href="/middleware/netty/nio/selectors/thread-factory.html">
        DefaultThreadFactory
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><div></div><!----></div></div>
    <script src="/assets/js/app.7acd518c.js" defer></script><script src="/assets/js/2.420b8cff.js" defer></script><script src="/assets/js/46.2549a636.js" defer></script>
  </body>
</html>
