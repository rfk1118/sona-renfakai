import{_ as e,V as o,W as c,Y as s,a1 as n,Z as t,a0 as p,F as i}from"./framework-e54e0297.js";const u={},l=s("h1",{id:"disperse",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#disperse","aria-hidden":"true"},"#"),n(" Disperse")],-1),r={href:"https://disperse.app/",target:"_blank",rel:"noopener noreferrer"},k=p(`<p>网站找到了其他链的调用地址:</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token literal-property property">address</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token number">1</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">3</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">4</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">5</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">42</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">56</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">77</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">99</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">100</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">137</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">163</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">250</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">5777</span><span class="token operator">:</span> <span class="token string">&quot;0x5b1869d9a4c187f2eaa108f3062412ecf0526b24&quot;</span><span class="token punctuation">,</span>
    <span class="token number">42161</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">4689</span><span class="token operator">:</span> <span class="token string">&quot;0xe3122e446Bf31036DA212375803f24b3dE96D0c9&quot;</span><span class="token punctuation">,</span>
    <span class="token number">1284</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">1285</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">42220</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">1666600000</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">60</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">128</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">66</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">10</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">84531</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">1101</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">8453</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span><span class="token punctuation">,</span>
    <span class="token number">11155111</span><span class="token operator">:</span> <span class="token string">&quot;0xD152f549545093347A162Dce210e7293f1452150&quot;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>abi如下：</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code> <span class="token literal-property property">abi</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;function disperseEther(address[] recipients, uint256[] values)&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;function disperseToken(address token, address[] recipients, uint256[] values)&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;function disperseTokenSimple(address token, address[] recipients, uint256[] values)&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="代码解读" tabindex="-1"><a class="header-anchor" href="#代码解读" aria-hidden="true">#</a> 代码解读</h2>`,5),d={href:"https://etherscan.io/address/0xD152f549545093347A162Dce210e7293f1452150#code",target:"_blank",rel:"noopener noreferrer"},v=p(`<div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token comment">// 版本</span>
pragma solidity <span class="token operator">^</span><span class="token number">0.4</span><span class="token number">.25</span><span class="token punctuation">;</span>

<span class="token comment">// 传输erc20使用</span>
<span class="token keyword">interface</span> <span class="token class-name"><span class="token constant">IERC20</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">transfer</span><span class="token punctuation">(</span>address to<span class="token punctuation">,</span> uint256 value<span class="token punctuation">)</span> external <span class="token function">returns</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">transferFrom</span><span class="token punctuation">(</span>address from<span class="token punctuation">,</span> address to<span class="token punctuation">,</span> uint256 value<span class="token punctuation">)</span> external <span class="token function">returns</span> <span class="token punctuation">(</span>bool<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

contract Disperse <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">disperseEther</span><span class="token punctuation">(</span>address<span class="token punctuation">[</span><span class="token punctuation">]</span> recipients<span class="token punctuation">,</span> uint256<span class="token punctuation">[</span><span class="token punctuation">]</span> values<span class="token punctuation">)</span> external payable <span class="token punctuation">{</span>
        <span class="token comment">// 按照账户进行分发金额</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>uint256 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> recipients<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            recipients<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 查看地址是否有余额</span>
        uint256 balance <span class="token operator">=</span> <span class="token function">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span>balance<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>balance <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            msg<span class="token punctuation">.</span>sender<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">disperseToken</span><span class="token punctuation">(</span><span class="token constant">IERC20</span> token<span class="token punctuation">,</span> address<span class="token punctuation">[</span><span class="token punctuation">]</span> recipients<span class="token punctuation">,</span> uint256<span class="token punctuation">[</span><span class="token punctuation">]</span> values<span class="token punctuation">)</span> external <span class="token punctuation">{</span>
        uint256 total <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token comment">// 计算要分发的代币总量</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>uint256 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> recipients<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            total <span class="token operator">+=</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 要求地址传输总代币成功</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> <span class="token function">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> total<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 想各个地址传输代币</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> recipients<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token keyword">require</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>recipients<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 前提是需要授权过</span>
    <span class="token keyword">function</span> <span class="token function">disperseTokenSimple</span><span class="token punctuation">(</span><span class="token constant">IERC20</span> token<span class="token punctuation">,</span> address<span class="token punctuation">[</span><span class="token punctuation">]</span> recipients<span class="token punctuation">,</span> uint256<span class="token punctuation">[</span><span class="token punctuation">]</span> values<span class="token punctuation">)</span> external <span class="token punctuation">{</span>
        <span class="token comment">// 传输代币给特定地址</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>uint256 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> recipients<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            <span class="token keyword">require</span><span class="token punctuation">(</span>token<span class="token punctuation">.</span><span class="token function">transferFrom</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> recipients<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> values<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h2><p><code>require(token.transferFrom(msg.sender, address(this), total));</code>这段代码即有好处又有坏处，好处是可以防止后续取消授权带来问题， 代码移除<code>require</code>代币传输失败会导致部分代币滞留在合约内。</p>`,3);function m(b,f){const a=i("ExternalLinkIcon");return o(),c("div",null,[l,s("p",null,[n("很好用的一个工具，"),s("a",r,[n("网站地址"),t(a)]),n("。")]),k,s("p",null,[s("a",d,[n("eth scan"),t(a)]),n("代码如下：")]),v])}const D=e(u,[["render",m],["__file","disperse.html.vue"]]);export{D as default};
