import{_ as o}from"./three-hand-2f6a0693.js";import{_ as l,V as c,W as d,Y as e,a1 as t,Z as n,$ as p,a0 as s,F as a}from"./framework-1bd9c91b.js";const h="/assets/four-1-271844ce.jpg",_="/assets/four-3-48180093.jpg",m="/assets/four-4-3e589a71.jpg",g="/assets/four-5-711ff060.jpg",f="/assets/half-close-f1491cab.jpg",u="/assets/four-2-1-4e94df7e.jpg",v="/assets/415-11df0bf4.jpg",b={},x=s('<h1 id="四次挥手" tabindex="-1"><a class="header-anchor" href="#四次挥手" aria-hidden="true">#</a> 四次挥手</h1><p>四次挥手是客户端和服务端进行关闭连接前置动作。</p><h2 id="实战" tabindex="-1"><a class="header-anchor" href="#实战" aria-hidden="true">#</a> 实战</h2><p>四次挥手基本流程图，也就是下图中的 segment4-7</p><div style="text-align:center;"><p><img src="'+o+'" alt="An image"></p></div>',5),k={class:"hint-container tip"},A=e("p",{class:"hint-container-title"},"提示",-1),C=e("code",null,"FIN ACK",-1),N={href:"https://github.com/sona0402/netty/blob/master/src/main/java/channelhandlers/TcpDnsClient.java",target:"_blank",rel:"noopener noreferrer"},T=e("code",null,"WireShark",-1),y=e("code",null,"tcp.port == 53",-1),j=s('<div style="text-align:center;"><p><img src="'+h+'" alt="An image"></p></div><p>TCP 是双工的，所以涉及到半关问题，一般情况下需要 4 次挥手，在合适的场景使用 3 次挥手（合并一次挥手）</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>There are six flag bits in the TCP header. One or more of them can be turned on at the same time. We briefly mention their use here and discuss each flag in more detail in later chapters.</p><p>在这里有一句话， <code>One or more of them can be turned on at the same time.</code> 在一个段中可能会出现多个 <code>flag</code></p><ul><li>URG The urgent pointer is valid (Section 20.8).</li><li>ACK The acknowledgment number is valid.</li><li>PSH The receiver should pass this data to the application as soon as possible (Section 20.5).</li><li>RST Reset the connection (Section 18.7).</li><li>SYN Synchronize sequence numbers to initiate a connection. This flag and the next are described in Chapter 18.</li><li>FIN The sender is finished sending data.</li></ul></div><p>看一下三次挥手，client 发送完数据，发送一个 FIN 数据段，其中 client 序列号为 36</p><div style="text-align:center;"><p><img src="'+_+'" alt="An image"></p></div><p>server 数据发送完了，所以是可以断开的，所以这里将<code>FIN ACK</code>进行合并了，对 client 的序号进行+1 确认，并给出 server 序号 52，这个时候 server 对 client 的写连接已经关闭，并发送读断开的 FIN</p><div style="text-align:center;"><p><img src="'+m+'" alt="An image"></p></div><p>client 收到后，对 server 序号+1，发送到 server，让 server 进行确认</p><div style="text-align:center;"><p><img src="'+g+'" alt="An image"></p></div><h3 id="半关" tabindex="-1"><a class="header-anchor" href="#半关" aria-hidden="true">#</a> 半关</h3><p>查看半关案例</p><div style="text-align:center;"><p><img src="'+f+'" alt="An image">图来自《TCP IP 协议详解卷一：协议》</p></div>',12),I={href:"https://github.com/sona0402/netty/tree/master/src/main/java/tcp",target:"_blank",rel:"noopener noreferrer"},S=s('<p>wireshark 抓本地环绕，使用<code>tcp.port == 4444</code>过滤条件进行查看</p><div style="text-align:center;"><p><img src="'+u+'" alt="An image"></p></div><ol><li>no.329 client 发送 FIN</li><li>no.330 server ACK</li><li>no.415 server 发送数据</li></ol><div style="text-align:center;"><p><img src="'+v+'" alt="An image"></p></div><ol start="4"><li>no.416 数据的 data 的 ACK</li><li>no.417 server 发出 FIN</li><li>no.418 client 发出 ACK</li></ol><h2 id="参考材料" tabindex="-1"><a class="header-anchor" href="#参考材料" aria-hidden="true">#</a> 参考材料</h2>',6),F={href:"https://book.douban.com/subject/1088054/",target:"_blank",rel:"noopener noreferrer"};function P(K,w){const r=a("RouterLink"),i=a("ExternalLinkIcon");return c(),d("div",null,[x,e("div",k,[A,e("p",null,[C,t("请查看"),n(r,{to:"/basic-skill/network/tree-shake-hands.html"},{default:p(()=>[t("三次握手")]),_:1})])]),e("p",null,[t("使用"),e("a",N,[t("代码"),n(i)]),t("进行 DNS 查询，并使用"),T,t("进行抓包，抓包使用 filter 进行过滤，过滤条件为"),y,t("，过滤后的结果如下图所示:")]),j,e("p",null,[t("如果想产生 4 次挥手，最好的测试就是 client 发送数据，发送写数据请求，然后 server 发送数据，使用"),e("a",I,[t("代码"),n(i)]),t("进行半关测试")]),S,e("p",null,[e("a",F,[t("TCP/IP 详解 卷 1：协议"),n(i)])])])}const L=l(b,[["render",P],["__file","four-wave.html.vue"]]);export{L as default};
