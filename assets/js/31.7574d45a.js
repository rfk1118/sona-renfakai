(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{441:function(t,s,a){t.exports=a.p+"assets/img/IncludedGC0.3a302190.png"},442:function(t,s,a){t.exports=a.p+"assets/img/IncludedGC3.db873f8b.png"},596:function(t,s,a){"use strict";a.r(s);var n=a(19),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"jvm-select"}},[t._v("jvm-select")]),t._v(" "),n("p",[t._v("启动虚拟机时增加 "),n("code",[t._v("-XX:")]),t._v(" 参数可以选择不同类型的垃圾回收器，垃圾回收器主要分为两大类：吞吐量、最大停顿时间。不同版本"),n("code",[t._v("jvm")]),t._v("下可以选择的垃圾回收有所变化。\n现在查看不同版本怎么选择垃圾回收器。")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://docs.oracle.com/javase/8/docs/technotes/guides/vm/gctuning/collectors.html#sthref27",target:"_blank",rel:"noopener noreferrer"}},[t._v("javase8"),n("OutboundLink")],1)]),t._v(" "),n("ul",[n("li",[t._v("如果应用程序的数据集很小（最高可达100MB），那么选择单线程序列收集器，使用参数"),n("code",[t._v("-XX:+UseSerialGC")])]),t._v(" "),n("li",[t._v("如果应用程序将在单个处理器上运行，并且没有暂停时间要求，则让"),n("code",[t._v("VM")]),t._v("选择收集器，或选择具有"),n("code",[t._v("-XX:+UseSerialGC")]),t._v("选项的单线程收集器")]),t._v(" "),n("li",[t._v("如果峰值应用程序性能是第一个优先级，并且没有暂停时间要求或暂停1秒或更长时间是可以接受的，那么让VM选择集器，或选择带有"),n("code",[t._v("-XX:+UseParallelGC")]),t._v("的并行集器")]),t._v(" "),n("li",[t._v("如果响应时间比整体吞吐量更重要，并且垃圾收集暂停时间必须缩短约1秒，请选择具有"),n("code",[t._v("-XX:+UseConcMarkSweepGC")]),t._v("或"),n("code",[t._v("-XX:+UseG1GC")]),t._v("的并发收集器")])]),t._v(" "),n("p",[t._v("其他版本省略...")]),t._v(" "),n("p",[n("a",{attrs:{href:"https://docs.oracle.com/en/java/javase/17/gctuning/available-collectors.html#GUID-F215A508-9E58-40B4-90A5-74E29BF3BD3C",target:"_blank",rel:"noopener noreferrer"}},[t._v("javase17"),n("OutboundLink")],1)]),t._v(" "),n("ul",[n("li",[t._v("如果应用程序的数据集很小（最高可达100MB），那么选择单线程序列收集器，使用参数"),n("code",[t._v("-XX:+UseSerialGC")])]),t._v(" "),n("li",[t._v("如果应用程序将在单个处理器上运行，并且没有暂停时间要求，则让VM选择收集器，或选择具有"),n("code",[t._v("-XX:+UseSerialGC")]),t._v("选项的单线程收集器")]),t._v(" "),n("li",[t._v("如果响应时间比整体吞吐量更重要，并且垃圾收集暂停时间必须缩短，那么请选择主要并发的收集器与"),n("code",[t._v("-XX:+UseG1GC")])]),t._v(" "),n("li",[t._v("如果响应时间是高优先级，请选择一个具有"),n("code",[t._v("-XX:UseZGC")]),t._v("的完全并发集器。")])]),t._v(" "),n("h2",{attrs:{id:"启动顺序"}},[t._v("启动顺序")]),t._v(" "),n("p",[t._v("使用"),n("code",[t._v("-XX:+UseSerialGC")]),t._v("启动"),n("code",[t._v("jvm")]),t._v("查看垃圾回收器的启动顺序，垃圾回收器启动对配置文件"),n("code",[t._v("config = gcConfig")]),t._v("初始化，调用栈关系如下：")]),t._v(" "),n("div",{staticClass:"language-C extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[t._v("Breakpoint reached"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" gcConfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("144")]),t._v("\nStack"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" \n  GCConfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("select_gc")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" gcConfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("146")]),t._v("\n  GCConfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("initialize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" gcConfig"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("179")]),t._v("\n  Arguments"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("set_ergonomics_flags")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" arguments"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1610")]),t._v("\n  Arguments"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("apply_ergo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" arguments"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4053")]),t._v("\n  Threads"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_vm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("JavaVMInitArgs"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bool"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" thread"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2714")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("JNI_CreateJavaVM")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("JavaVM "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" jni"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3613")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("JNI_CreateJavaVM")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("JavaVM "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" jni"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3701")]),t._v("\n  JavaMain java"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("c"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1459")]),t._v("\n  JavaMain java"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("c"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("411")]),t._v("\n  ThreadJavaMain java_md_macosx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("m"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("722")]),t._v("\n  _pthread_start "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x00007ff8121814f4")]),t._v("\n  thread_start "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x00007ff81217d00f")]),t._v("\n")])])]),n("p",[n("code",[t._v("GCConfig")]),t._v("初始化时候会选择一个垃圾回收器类型，从"),n("code",[t._v("GCConfig::initialize")]),t._v("方法中可以看出。")]),t._v(" "),n("div",{staticClass:"language-C extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" GCConfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("initialize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 选择gc")]),t._v("\n  _arguments "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("select_gc")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\nGCArguments"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" GCConfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("select_gc")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fail_if_non_included_gc_is_selected")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 异常退出")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("is_no_gc_selected")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("select_gc_ergonomically")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("is_no_gc_selected")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vm_exit_during_initialization")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Garbage collector not selected "')]),t._v("\n                                    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"(default collector explicitly disabled)"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    _gc_selected_ergonomically "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" true"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 异常退出")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("is_exactly_one_gc_selected")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("vm_exit_during_initialization")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Multiple garbage collectors selected"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  \n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 这里会选择垃圾回收器")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("FOR_EACH_INCLUDED_GC")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gc"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 如果开启返回结果")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gc"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("_flag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("gc"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),t._v("_arguments"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 没有找到，应用程序启动失败")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("fatal")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"Should have found the selected GC"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("NULL")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[n("code",[t._v("FOR_EACH_INCLUDED_GC")]),t._v("会调用宏代码，代码如下：")]),t._v(" "),n("div",{staticClass:"language-C extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token macro property"}},[n("span",{pre:!0,attrs:{class:"token directive-hash"}},[t._v("#")]),n("span",{pre:!0,attrs:{class:"token directive keyword"}},[t._v("define")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token macro-name function"}},[t._v("FOR_EACH_INCLUDED_GC")]),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("var"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("                                            ")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token expression"}},[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("for")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" IncludedGC"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" var "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("IncludedGCs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" var "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("IncludedGCs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ARRAY_SIZE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("IncludedGCs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v(" var"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")])])]),t._v("\n")])])]),n("p",[t._v("整个数组的情况如下，并且从"),n("code",[t._v("IncludedGC")]),t._v("结构中可以看到参数分别为"),n("code",[t._v("flag、name、arguments、hs_err_name")]),t._v("，这里的"),n("code",[t._v("flag")]),t._v("是否开启标记根据"),n("code",[t._v("command line flag")]),t._v("设置的。"),n("code",[t._v("flag = true")]),t._v("就是"),n("code",[t._v("-XX:")]),t._v("设置选择的垃圾回收器。")]),t._v(" "),n("div",{staticClass:"language-C extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Table of included GCs, for translating between command")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// line flag, CollectedHeap::Name and GCArguments instance.")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("static")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" IncludedGC IncludedGCs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n   "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("EPSILONGC_ONLY_ARG")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("IncludedGC")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UseEpsilonGC"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("       CollectedHeap"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("Epsilon"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    epsilonArguments"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"epsilon gc"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("G1GC_ONLY_ARG")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("IncludedGC")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UseG1GC"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("            CollectedHeap"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("G1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("         g1Arguments"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("         "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"g1 gc"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("PARALLELGC_ONLY_ARG")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("IncludedGC")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UseParallelGC"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("      CollectedHeap"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("Parallel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   parallelArguments"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("   "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"parallel gc"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SERIALGC_ONLY_ARG")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("IncludedGC")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UseSerialGC"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("        CollectedHeap"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("Serial"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("     serialArguments"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"serial gc"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SHENANDOAHGC_ONLY_ARG")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("IncludedGC")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UseShenandoahGC"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("    CollectedHeap"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("Shenandoah"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" shenandoahArguments"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"shenandoah gc"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n         "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ZGC_ONLY_ARG")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("IncludedGC")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("UseZGC"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("             CollectedHeap"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("Z"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("          zArguments"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("          "),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"z gc"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("struct")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IncludedGC")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  bool"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("               _flag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  CollectedHeap"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("Name _name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  GCArguments"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("        _arguments"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("         _hs_err_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("IncludedGC")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("bool"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" flag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" CollectedHeap"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),t._v("Name name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" GCArguments"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v(" arguments"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("char")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" hs_err_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("_flag")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("flag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("_arguments")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("arguments"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("_hs_err_name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hs_err_name"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("p",[n("code",[t._v("jvm")]),t._v("启动时，使用的参数为"),n("code",[t._v("-XX:+UseSerialGC")]),t._v("，可以从下图中看到"),n("code",[t._v("SerialGC")]),t._v("的"),n("code",[t._v("flag = true")]),t._v("，其他垃圾回收器为"),n("code",[t._v("flag = false")]),t._v("。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(441),alt:"An image"}}),t._v(" "),n("img",{attrs:{src:a(442),alt:"An image"}})]),t._v(" "),n("p",[n("code",[t._v("GCConfig::initialize")]),t._v("会将"),n("code",[t._v("_arguments")]),t._v("设置成"),n("code",[t._v("SerialArguments")]),t._v("，这里是工厂设计模式，"),n("code",[t._v("SerialArguments")]),t._v("代码如下：")]),t._v(" "),n("div",{staticClass:"language-C extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[t._v("class CollectedHeap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\nclass SerialArguments "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" public GenArguments "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\nprivate"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v("\n  virtual CollectedHeap"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_heap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 工厂设计模式")]),t._v("\nCollectedHeap"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" SerialArguments"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_heap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" new "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("SerialHeap")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("工厂创建对象进行初始化，这里已经指定了初始化堆"),n("code",[t._v("SerialHeap")]),t._v("的类型。")]),t._v(" "),n("div",{staticClass:"language-C extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[t._v("Breakpoint reached"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" serialHeap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("53")]),t._v("\nStack"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" \n  SerialHeap"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("initialize_serviceability")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" serialHeap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("57")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 模版方法")]),t._v("\n  GenCollectedHeap"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("post_initialize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" genCollectedHeap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("195")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("universe_post_init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" universe"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1019")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 初始化全局")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("init_globals")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" init"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("156")]),t._v("\n  Threads"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("create_vm")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("JavaVMInitArgs"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" bool"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" thread"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2813")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("JNI_CreateJavaVM")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("JavaVM "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" jni"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3613")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("JNI_CreateJavaVM")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("JavaVM "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" jni"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cpp"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3701")]),t._v("\n  JavaMain java"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("c"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1459")]),t._v("\n  JavaMain java"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("c"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("411")]),t._v("\n  ThreadJavaMain java_md_macosx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("m"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("722")]),t._v("\n  _pthread_start "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x00007ff8121814f4")]),t._v("\n  thread_start "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0x00007ff81217d00f")]),t._v("\n")])])]),n("p",[n("code",[t._v("post_initialize")]),t._v("模版方法会调用底层实现策略，进行堆垃圾回收设定，关于"),n("a",{attrs:{href:"./SerialHeap"}},[t._v("SerialHeap")])]),t._v(" "),n("div",{staticClass:"language-C extra-class"},[n("pre",{pre:!0,attrs:{class:"language-c"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" GenCollectedHeap"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("post_initialize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 会进行策略分发")]),t._v("\n  CollectedHeap"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("post_initialize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("ref_processing_init")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 新生代使用DefNewGeneration")]),t._v("\n  DefNewGeneration"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" def_new_gen "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("DefNewGeneration"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("_young_gen"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("initialize_size_policy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("def_new_gen"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("eden")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("capacity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                         _old_gen"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("capacity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n                         def_new_gen"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("from")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("->")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("capacity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  MarkSweep"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("initialize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  ScavengableNMethods"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("::")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("initialize")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("&")]),t._v("_is_scavengable"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("h2",{attrs:{id:"总结"}},[t._v("总结")]),t._v(" "),n("p",[t._v("虚拟机在创建虚拟机时会根据参数选择不同虚拟机垃圾回收进行启动，并在"),n("code",[t._v("post_initialize")]),t._v("调用策略进行初始化。")])])}),[],!1,null,null,null);s.default=e.exports}}]);