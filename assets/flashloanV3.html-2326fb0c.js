const n=JSON.parse('{"key":"v-07da96d3","path":"/web3/flashloanV3.html","title":"FlashLoanV3","lang":"zh-CN","frontmatter":{"description":"FlashLoanV3 将V2版本升级到V3版本，代码如下： // contracts/FlashLoan.sol // SPDX-License-Identifier: MIT pragma solidity 0.8.10; import {FlashLoanSimpleReceiverBase} from \\"@aave/core-v3/contracts/flashloan/base/FlashLoanSimpleReceiverBase.sol\\"; import {IPoolAddressesProvider} from \\"@aave/core-v3/contracts/interfaces/IPoolAddressesProvider.sol\\"; import {IERC20} from \\"@aave/core-v3/contracts/dependencies/openzeppelin/contracts/IERC20.sol\\"; contract FlashLoan is FlashLoanSimpleReceiverBase { address payable owner; constructor( address _addressProvider ) FlashLoanSimpleReceiverBase(IPoolAddressesProvider(_addressProvider)) { owner = payable(msg.sender); } function executeOperation( address asset, uint256 amount, uint256 premium, address /**initiator**/, bytes calldata /**params**/ ) external override returns (bool) { // 允许池子可以还代币 uint256 amountOwed = amount + premium; IERC20(asset).approve(address(POOL), amountOwed); return true; } function requestFlashLoan(address _token, uint256 _amount) public { POOL.flashLoanSimple(address(this), _token, _amount, \\"\\", 0); } function getBalance(address _tokenAddress) external view returns (uint256) { return IERC20(_tokenAddress).balanceOf(address(this)); } function withdraw(address _tokenAddress) external onlyOwner { IERC20 token = IERC20(_tokenAddress); token.transfer(msg.sender, token.balanceOf(address(this))); } // 只有owner可以调用一些功能 modifier onlyOwner() { require( msg.sender == owner, \\"Only the contract owner can call this function\\" ); _; } // 可以接收eth receive() external payable {} }","head":[["meta",{"property":"og:url","content":"https://renfakai.com/web3/flashloanV3.html"}],["meta",{"property":"og:site_name","content":"天道酬勤"}],["meta",{"property":"og:title","content":"FlashLoanV3"}],["meta",{"property":"og:description","content":"FlashLoanV3 将V2版本升级到V3版本，代码如下： // contracts/FlashLoan.sol // SPDX-License-Identifier: MIT pragma solidity 0.8.10; import {FlashLoanSimpleReceiverBase} from \\"@aave/core-v3/contracts/flashloan/base/FlashLoanSimpleReceiverBase.sol\\"; import {IPoolAddressesProvider} from \\"@aave/core-v3/contracts/interfaces/IPoolAddressesProvider.sol\\"; import {IERC20} from \\"@aave/core-v3/contracts/dependencies/openzeppelin/contracts/IERC20.sol\\"; contract FlashLoan is FlashLoanSimpleReceiverBase { address payable owner; constructor( address _addressProvider ) FlashLoanSimpleReceiverBase(IPoolAddressesProvider(_addressProvider)) { owner = payable(msg.sender); } function executeOperation( address asset, uint256 amount, uint256 premium, address /**initiator**/, bytes calldata /**params**/ ) external override returns (bool) { // 允许池子可以还代币 uint256 amountOwed = amount + premium; IERC20(asset).approve(address(POOL), amountOwed); return true; } function requestFlashLoan(address _token, uint256 _amount) public { POOL.flashLoanSimple(address(this), _token, _amount, \\"\\", 0); } function getBalance(address _tokenAddress) external view returns (uint256) { return IERC20(_tokenAddress).balanceOf(address(this)); } function withdraw(address _tokenAddress) external onlyOwner { IERC20 token = IERC20(_tokenAddress); token.transfer(msg.sender, token.balanceOf(address(this))); } // 只有owner可以调用一些功能 modifier onlyOwner() { require( msg.sender == owner, \\"Only the contract owner can call this function\\" ); _; } // 可以接收eth receive() external payable {} }"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2023-08-29T13:46:07.000Z"}],["meta",{"property":"article:modified_time","content":"2023-08-29T13:46:07.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"FlashLoanV3\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2023-08-29T13:46:07.000Z\\",\\"author\\":[]}"]]},"headers":[{"level":2,"title":"编写测试用例","slug":"编写测试用例","link":"#编写测试用例","children":[]},{"level":2,"title":"提示","slug":"提示","link":"#提示","children":[]}],"git":{"createdTime":1693316767000,"updatedTime":1693316767000,"contributors":[{"name":"renfakai","email":"rfk1118@gmail.com","commits":1}]},"readingTime":{"minutes":3.46,"words":1037},"filePathRelative":"web3/flashloanV3.md","localizedDate":"2023年8月29日","excerpt":"<h1> FlashLoanV3</h1>\\n<p>将V2版本升级到V3版本，代码如下：</p>\\n<div class=\\"language-solidity line-numbers-mode\\" data-ext=\\"solidity\\"><pre class=\\"language-solidity\\"><code><span class=\\"token comment\\">// contracts/FlashLoan.sol</span>\\n<span class=\\"token comment\\">// SPDX-License-Identifier: MIT</span>\\n<span class=\\"token keyword\\">pragma</span> <span class=\\"token keyword\\">solidity</span> <span class=\\"token number\\">0.8</span><span class=\\"token number\\">.10</span><span class=\\"token punctuation\\">;</span>\\n\\n<span class=\\"token keyword\\">import</span> <span class=\\"token punctuation\\">{</span>FlashLoanSimpleReceiverBase<span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">\\"@aave/core-v3/contracts/flashloan/base/FlashLoanSimpleReceiverBase.sol\\"</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">import</span> <span class=\\"token punctuation\\">{</span>IPoolAddressesProvider<span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">\\"@aave/core-v3/contracts/interfaces/IPoolAddressesProvider.sol\\"</span><span class=\\"token punctuation\\">;</span>\\n<span class=\\"token keyword\\">import</span> <span class=\\"token punctuation\\">{</span>IERC20<span class=\\"token punctuation\\">}</span> <span class=\\"token keyword\\">from</span> <span class=\\"token string\\">\\"@aave/core-v3/contracts/dependencies/openzeppelin/contracts/IERC20.sol\\"</span><span class=\\"token punctuation\\">;</span>\\n\\n<span class=\\"token keyword\\">contract</span> <span class=\\"token class-name\\">FlashLoan</span> <span class=\\"token keyword\\">is</span> FlashLoanSimpleReceiverBase <span class=\\"token punctuation\\">{</span>\\n    <span class=\\"token builtin\\">address</span> <span class=\\"token keyword\\">payable</span> owner<span class=\\"token punctuation\\">;</span>\\n\\n    <span class=\\"token keyword\\">constructor</span><span class=\\"token punctuation\\">(</span>\\n        <span class=\\"token builtin\\">address</span> _addressProvider\\n    <span class=\\"token punctuation\\">)</span> <span class=\\"token function\\">FlashLoanSimpleReceiverBase</span><span class=\\"token punctuation\\">(</span><span class=\\"token function\\">IPoolAddressesProvider</span><span class=\\"token punctuation\\">(</span>_addressProvider<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n        owner <span class=\\"token operator\\">=</span> <span class=\\"token keyword\\">payable</span><span class=\\"token punctuation\\">(</span>msg<span class=\\"token punctuation\\">.</span>sender<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n    <span class=\\"token punctuation\\">}</span>\\n\\n    <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">executeOperation</span><span class=\\"token punctuation\\">(</span>\\n        <span class=\\"token builtin\\">address</span> asset<span class=\\"token punctuation\\">,</span>\\n        <span class=\\"token builtin\\">uint256</span> amount<span class=\\"token punctuation\\">,</span>\\n        <span class=\\"token builtin\\">uint256</span> premium<span class=\\"token punctuation\\">,</span>\\n        <span class=\\"token builtin\\">address</span> <span class=\\"token comment\\">/**initiator**/</span><span class=\\"token punctuation\\">,</span>\\n        <span class=\\"token builtin\\">bytes</span> <span class=\\"token keyword\\">calldata</span> <span class=\\"token comment\\">/**params**/</span>\\n    <span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">external</span> override <span class=\\"token keyword\\">returns</span> <span class=\\"token punctuation\\">(</span><span class=\\"token builtin\\">bool</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token comment\\">// 允许池子可以还代币</span>\\n        <span class=\\"token builtin\\">uint256</span> amountOwed <span class=\\"token operator\\">=</span> amount <span class=\\"token operator\\">+</span> premium<span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token function\\">IERC20</span><span class=\\"token punctuation\\">(</span>asset<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">approve</span><span class=\\"token punctuation\\">(</span><span class=\\"token builtin\\">address</span><span class=\\"token punctuation\\">(</span>POOL<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> amountOwed<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token keyword\\">return</span> <span class=\\"token boolean\\">true</span><span class=\\"token punctuation\\">;</span>\\n    <span class=\\"token punctuation\\">}</span>\\n\\n    <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">requestFlashLoan</span><span class=\\"token punctuation\\">(</span><span class=\\"token builtin\\">address</span> _token<span class=\\"token punctuation\\">,</span> <span class=\\"token builtin\\">uint256</span> _amount<span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">public</span> <span class=\\"token punctuation\\">{</span>\\n        POOL<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">flashLoanSimple</span><span class=\\"token punctuation\\">(</span><span class=\\"token builtin\\">address</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">,</span> _token<span class=\\"token punctuation\\">,</span> _amount<span class=\\"token punctuation\\">,</span> <span class=\\"token string\\">\\"\\"</span><span class=\\"token punctuation\\">,</span> <span class=\\"token number\\">0</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n    <span class=\\"token punctuation\\">}</span>\\n\\n    <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">getBalance</span><span class=\\"token punctuation\\">(</span><span class=\\"token builtin\\">address</span> _tokenAddress<span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">external</span> <span class=\\"token keyword\\">view</span> <span class=\\"token keyword\\">returns</span> <span class=\\"token punctuation\\">(</span><span class=\\"token builtin\\">uint256</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token keyword\\">return</span> <span class=\\"token function\\">IERC20</span><span class=\\"token punctuation\\">(</span>_tokenAddress<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">.</span><span class=\\"token function\\">balanceOf</span><span class=\\"token punctuation\\">(</span><span class=\\"token builtin\\">address</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n    <span class=\\"token punctuation\\">}</span>\\n\\n    <span class=\\"token keyword\\">function</span> <span class=\\"token function\\">withdraw</span><span class=\\"token punctuation\\">(</span><span class=\\"token builtin\\">address</span> _tokenAddress<span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">external</span> onlyOwner <span class=\\"token punctuation\\">{</span>\\n        IERC20 token <span class=\\"token operator\\">=</span> <span class=\\"token function\\">IERC20</span><span class=\\"token punctuation\\">(</span>_tokenAddress<span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n        token<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">transfer</span><span class=\\"token punctuation\\">(</span>msg<span class=\\"token punctuation\\">.</span>sender<span class=\\"token punctuation\\">,</span> token<span class=\\"token punctuation\\">.</span><span class=\\"token function\\">balanceOf</span><span class=\\"token punctuation\\">(</span><span class=\\"token builtin\\">address</span><span class=\\"token punctuation\\">(</span><span class=\\"token keyword\\">this</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n    <span class=\\"token punctuation\\">}</span>\\n\\n    <span class=\\"token comment\\">// 只有owner可以调用一些功能</span>\\n    <span class=\\"token keyword\\">modifier</span> <span class=\\"token function\\">onlyOwner</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token punctuation\\">{</span>\\n        <span class=\\"token keyword\\">require</span><span class=\\"token punctuation\\">(</span>\\n            msg<span class=\\"token punctuation\\">.</span>sender <span class=\\"token operator\\">==</span> owner<span class=\\"token punctuation\\">,</span>\\n            <span class=\\"token string\\">\\"Only the contract owner can call this function\\"</span>\\n        <span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n        <span class=\\"token keyword\\">_</span><span class=\\"token punctuation\\">;</span>\\n    <span class=\\"token punctuation\\">}</span>\\n\\n    <span class=\\"token comment\\">// 可以接收eth</span>\\n    <span class=\\"token function\\">receive</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span> <span class=\\"token keyword\\">external</span> <span class=\\"token keyword\\">payable</span> <span class=\\"token punctuation\\">{</span><span class=\\"token punctuation\\">}</span>\\n<span class=\\"token punctuation\\">}</span>\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","copyright":{},"autoDesc":true}');export{n as data};
