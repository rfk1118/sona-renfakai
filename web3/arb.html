<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.60" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://renfakai.com/web3/arb.html"><meta property="og:site_name" content="å¤©é“é…¬å‹¤"><meta property="og:title" content="å¥—åˆ©"><meta property="og:description" content="å¥—åˆ© ä»£ç åœ°å€ å¯åŠ¨ç¨‹åº å¯åŠ¨ç¨‹åºä¸»è¦åŒ…å«ä¸‰ä¸ªç»´åº¦é“¾ä¸‹ä»£ç ï¼š ç›‘å¬è€… æ± å­æŸ¥è¯¢ å¥—åˆ©ç»‘å®šä»£ç  å…¨å±€ç»‘å®šä¸‰è€…å…³ç³» è¿™ä¸€æ®µä¹Ÿå«ä¸Šå¸ä»£ç ã€‚ // è§£ææ•°æ® const data = JSON.parse(event.data); console.log("New transaction with hash:", data.hash); // å¦‚æœæ²¡æœ‰æ•°æ® if (data.logs == null) { return; } // Loop through all the logs in the transaction console.log("Transaction has logs, parsing them"); for (let i = 0; i &lt; data.logs.length; i++) { console.log(data.logs[i]); // åˆ¤æ–­æ˜¯å¦æ˜¯swapä¸»é¢˜ if (data.logs[i].topics[0] != config.syncTopic) { continue; } // Skip if it isn't a sync event // è·å–ç¬¬ä¸€ä¸ªäº¤æ˜“æ± å­ const firstPair = data.logs[i].address; // Get the address of the first pair, which is the address the logs are coming from console.log( "Transaction trading on Uniswap v2 pool detected! Pool address:", firstPair ); // æ ¹æ®ç¬¬ä¸€ä¸ªpairåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ± å­ const [token0, token1, factoryToCheck] = await poolManager.checkPool( firstPair ); // Get the pool and the other factory we need to check // æœªæ‰¾åˆ°æ± å­ if (token0 == false || token1 == false || factoryToCheck == false) { return; } // These are false if the pool does not have a WETH pair // è·å–åˆ°ç¬¬äºŒä¸ªæ± å­ const secondPair = await poolManager.checkFactory( factoryToCheck, token0, token1 ); // Check if the other factory has the pool too // æ²¡æœ‰å¥—åˆ©çš„æ± å­ if (secondPair == false) { return; } // If it doesn't, stop here // è¿›è¡Œå¥—åˆ© await bundleExecutor.execute(firstPair, secondPair, data.hash); // Execute the bundle if we've made it this far"><meta property="og:type" content="article"><meta property="og:image" content="https://renfakai.com/"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2023-10-13T08:09:53.000Z"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image:alt" content="å¥—åˆ©"><meta property="article:modified_time" content="2023-10-13T08:09:53.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"å¥—åˆ©","image":["https://renfakai.com/"],"dateModified":"2023-10-13T08:09:53.000Z","author":[]}</script><meta name="author" content="ä»»å‘å‡¯"><meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"><meta http-equiv="Pragma" content="no-cache"><meta http-equiv="Expires" content="0"><meta name="apple-mobile-web-app-capable" content="yes"><title>å¥—åˆ© | å¤©é“é…¬å‹¤</title><meta name="description" content="å¥—åˆ© ä»£ç åœ°å€ å¯åŠ¨ç¨‹åº å¯åŠ¨ç¨‹åºä¸»è¦åŒ…å«ä¸‰ä¸ªç»´åº¦é“¾ä¸‹ä»£ç ï¼š ç›‘å¬è€… æ± å­æŸ¥è¯¢ å¥—åˆ©ç»‘å®šä»£ç  å…¨å±€ç»‘å®šä¸‰è€…å…³ç³» è¿™ä¸€æ®µä¹Ÿå«ä¸Šå¸ä»£ç ã€‚ // è§£ææ•°æ® const data = JSON.parse(event.data); console.log("New transaction with hash:", data.hash); // å¦‚æœæ²¡æœ‰æ•°æ® if (data.logs == null) { return; } // Loop through all the logs in the transaction console.log("Transaction has logs, parsing them"); for (let i = 0; i &lt; data.logs.length; i++) { console.log(data.logs[i]); // åˆ¤æ–­æ˜¯å¦æ˜¯swapä¸»é¢˜ if (data.logs[i].topics[0] != config.syncTopic) { continue; } // Skip if it isn't a sync event // è·å–ç¬¬ä¸€ä¸ªäº¤æ˜“æ± å­ const firstPair = data.logs[i].address; // Get the address of the first pair, which is the address the logs are coming from console.log( "Transaction trading on Uniswap v2 pool detected! Pool address:", firstPair ); // æ ¹æ®ç¬¬ä¸€ä¸ªpairåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ± å­ const [token0, token1, factoryToCheck] = await poolManager.checkPool( firstPair ); // Get the pool and the other factory we need to check // æœªæ‰¾åˆ°æ± å­ if (token0 == false || token1 == false || factoryToCheck == false) { return; } // These are false if the pool does not have a WETH pair // è·å–åˆ°ç¬¬äºŒä¸ªæ± å­ const secondPair = await poolManager.checkFactory( factoryToCheck, token0, token1 ); // Check if the other factory has the pool too // æ²¡æœ‰å¥—åˆ©çš„æ± å­ if (secondPair == false) { return; } // If it doesn't, stop here // è¿›è¡Œå¥—åˆ© await bundleExecutor.execute(firstPair, secondPair, data.hash); // Execute the bundle if we've made it this far">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d1e1f;
      }

      html,
      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="preload" href="/assets/style-1085fd2c.css" as="style"><link rel="stylesheet" href="/assets/style-1085fd2c.css">
    <link rel="modulepreload" href="/assets/app-ef31af74.js"><link rel="modulepreload" href="/assets/framework-e54e0297.js"><link rel="modulepreload" href="/assets/arb.html-30d5f9ad.js"><link rel="modulepreload" href="/assets/arb.html-3b20b638.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><!--[--><div class="theme-container has-toc"><!--[--><header class="navbar" id="navbar"><div class="navbar-start"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!--[--><!----><!--]--><a href="/" class="brand"><!----><!----><span class="site-name">å¤©é“é…¬å‹¤</span></a><!--[--><!----><!--]--></div><div class="navbar-center"><!--[--><!----><!--]--><!----><!--[--><!----><!--]--></div><div class="navbar-end"><!--[--><!----><!--]--><!----><div class="nav-item"><a class="repo-link" href="https://github.com/rfk1118" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button class="search-pro-button" role="search" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg></button><!--]--><!--[--><!----><!--]--><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside class="sidebar" id="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><a href="/introduction/" class="nav-link sidebar-link sidebar-page" aria-label="å·¥ä½œç»å†"><!---->å·¥ä½œç»å†<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading clickable active"><!----><a href="/web3/" class="title">web3</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/web3/solitify/ierc20.html" class="nav-link sidebar-link sidebar-page" aria-label="IERC20"><!---->IERC20<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/web3/solitify/IUniswapV2Factory.html" class="nav-link sidebar-link sidebar-page" aria-label="IUniswapV2Factory"><!---->IUniswapV2Factory<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/web3/solitify/UniswapV2Pair.html" class="nav-link sidebar-link sidebar-page" aria-label="UniswapV2Pair"><!---->UniswapV2Pair<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/web3/convert-abi.html" class="nav-link sidebar-link sidebar-page" aria-label="Human-Readable ABI"><!---->Human-Readable ABI<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/web3/flashloan.html" class="nav-link sidebar-link sidebar-page" aria-label="FlashLoan"><!---->FlashLoan<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/web3/flashloanV3.html" class="nav-link sidebar-link sidebar-page" aria-label="FlashLoanV3"><!---->FlashLoanV3<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/web3/8e55.html" class="nav-link sidebar-link sidebar-page" aria-label="8e55"><!---->8e55<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/web3/UniswapV2Router01.html" class="nav-link sidebar-link sidebar-page" aria-label="UniswapV2Router01"><!---->UniswapV2Router01<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/web3/atomical.html" class="nav-link sidebar-link sidebar-page" aria-label="atomical"><!---->atomical<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/web3/disperse.html" class="nav-link sidebar-link sidebar-page" aria-label="Disperse"><!---->Disperse<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/web3/arb.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="å¥—åˆ©"><!---->å¥—åˆ©<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/web3/arb.html#å¯åŠ¨ç¨‹åº" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¯åŠ¨ç¨‹åº"><!---->å¯åŠ¨ç¨‹åº<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web3/arb.html#å…¨å±€ç»‘å®šä¸‰è€…å…³ç³»" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å…¨å±€ç»‘å®šä¸‰è€…å…³ç³»"><!---->å…¨å±€ç»‘å®šä¸‰è€…å…³ç³»<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web3/arb.html#ç›‘å¬è€…" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="ç›‘å¬è€…"><!---->ç›‘å¬è€…<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web3/arb.html#æ± å­æŸ¥è¯¢" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ± å­æŸ¥è¯¢"><!---->æ± å­æŸ¥è¯¢<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web3/arb.html#å¥—åˆ©ç»‘å®šä»£ç " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="å¥—åˆ©ç»‘å®šä»£ç "><!---->å¥—åˆ©ç»‘å®šä»£ç <!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web3/arb.html#åˆçº¦ä»£ç " class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="åˆçº¦ä»£ç "><!---->åˆçº¦ä»£ç <!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/web3/arb.html#æ€»ç»“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="æ€»ç»“"><!---->æ€»ç»“<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li><li><!--[--><a href="/web3/LIQUIDITY.html" class="nav-link sidebar-link sidebar-page" aria-label="æµåŠ¨æ€§è·å–"><!---->æµåŠ¨æ€§è·å–<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/web3/uniswap-getOutputAmount.html" class="nav-link sidebar-link sidebar-page" aria-label="GetOutputAmount"><!---->GetOutputAmount<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/terminology/" class="title">è‚¡ç¥¨</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/terminology/1A0001.html" class="nav-link sidebar-link sidebar-page" aria-label="ä¸Šè¯æŒ‡æ•°"><!---->ä¸Šè¯æŒ‡æ•°<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/terminology/601919.html" class="nav-link sidebar-link sidebar-page" aria-label="ä¸­è¿œæµ·æ§"><!---->ä¸­è¿œæµ·æ§<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/terminology/601515.html" class="nav-link sidebar-link sidebar-page" aria-label="ä¸œé£è‚¡ä»½"><!---->ä¸œé£è‚¡ä»½<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/eth/hook.html" class="nav-link sidebar-link sidebar-page" aria-label="hookå¸"><!---->hookå¸<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/terminology/zhurou.html" class="nav-link sidebar-link sidebar-page" aria-label="çŒªè‚‰è‚¡"><!---->çŒªè‚‰è‚¡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/thousand/" class="title">å›½å­¦</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/thousand/tree.html" class="nav-link sidebar-link sidebar-page" aria-label="ä¸‰å±±çŒ®é¼"><!---->ä¸‰å±±çŒ®é¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/middleware/" class="title">ä¸­é—´ä»¶</a><!----></p><ul class="sidebar-links"><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/middleware/netty/" class="title">Netty</a><!----></p><ul class="sidebar-links"><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/middleware/netty/knowledge/" class="title">åŸºç¡€çŸ¥è¯†</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/middleware/netty/knowledge/reference.html" class="nav-link sidebar-link sidebar-page" aria-label="å‚è€ƒèµ„æ–™"><!---->å‚è€ƒèµ„æ–™<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/middleware/netty/knowledge/read-source.html" class="nav-link sidebar-link sidebar-page" aria-label="å¦‚ä½•è¯»æºç "><!---->å¦‚ä½•è¯»æºç <!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/middleware/netty/knowledge/quick-start.html" class="nav-link sidebar-link sidebar-page" aria-label="å¿«é€Ÿä¸Šæ‰‹"><!---->å¿«é€Ÿä¸Šæ‰‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">EventLoop</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/middleware/netty/nio/event-loop/nio-event-loop-group.html" class="nav-link sidebar-link sidebar-page" aria-label="EventLoopGroup"><!---->EventLoopGroup<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/middleware/netty/nio/event-loop/nio-event-loop.html" class="nav-link sidebar-link sidebar-page" aria-label="EventLoop"><!---->EventLoop<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/middleware/netty/nio/selectors/selector.html" class="title">Selectors</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/middleware/netty/nio/selectors/open-selector.html" class="nav-link sidebar-link sidebar-page" aria-label="OpenSelector"><!---->OpenSelector<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/middleware/netty/nio/selectors/thread-factory.html" class="nav-link sidebar-link sidebar-page" aria-label="DefaultThreadFactory"><!---->DefaultThreadFactory<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/middleware/netty/nio/selectors/chooser-factory.html" class="nav-link sidebar-link sidebar-page" aria-label="ChooserFactory"><!---->ChooserFactory<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><!--[--><a href="/middleware/netty/nio/bootstrap/bootstrap.html" class="nav-link sidebar-link sidebar-page" aria-label="Bootstrap"><!---->Bootstrap<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/middleware/netty/nio/channels/channel.html" class="title">Channel</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/middleware/netty/nio/channels/channel-init.html" class="nav-link sidebar-link sidebar-page" aria-label="Channel-Init"><!---->Channel-Init<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/middleware/netty/nio/channels/channel-register.html" class="nav-link sidebar-link sidebar-page" aria-label="Channel-register"><!---->Channel-register<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/middleware/netty/nio/channels/channel-handler.html" class="nav-link sidebar-link sidebar-page" aria-label="Channel-handler"><!---->Channel-handler<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/middleware/netty/nio/channels/channel-bind.html" class="nav-link sidebar-link sidebar-page" aria-label="Channel-bind"><!---->Channel-bind<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/middleware/netty/nio/channels/channel-unsafe.html" class="nav-link sidebar-link sidebar-page" aria-label="Channel-Unsafe"><!---->Channel-Unsafe<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/middleware/netty/nio/channels/channel-pipeline.html" class="nav-link sidebar-link sidebar-page" aria-label="Channel-Pipeline"><!---->Channel-Pipeline<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><!--[--><a href="/middleware/netty/nio/codec/codec.html" class="nav-link sidebar-link sidebar-page" aria-label="Codec"><!---->Codec<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><!--[--><a href="/middleware/nginx/" class="nav-link sidebar-link sidebar-page" aria-label="nginx"><!---->nginx<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/framework/spring/" class="title">Spring</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/framework/spring/di-concept.html" class="nav-link sidebar-link sidebar-page" aria-label="DIæ¦‚å¿µ"><!---->DIæ¦‚å¿µ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/framework/spring/di.html" class="nav-link sidebar-link sidebar-page" aria-label="DIå®ç°"><!---->DIå®ç°<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/framework/spring/initialize-bean.html" class="nav-link sidebar-link sidebar-page" aria-label="æ‰©å±•ç‚¹"><!---->æ‰©å±•ç‚¹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">ç¼–ç¨‹è¯­è¨€</span><!----></p><ul class="sidebar-links"><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">Java</span><!----></p><ul class="sidebar-links"><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">è™šæ‹Ÿæœº</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/languages/java/jvm/jvm.html" class="nav-link sidebar-link sidebar-page" aria-label="jvm"><!---->jvm<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/jvm/layout/run-time-data-areas.html" class="nav-link sidebar-link sidebar-page" aria-label="è¿è¡Œæ—¶æ•°æ®"><!---->è¿è¡Œæ—¶æ•°æ®<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/jvm/layout/pc-register.html" class="nav-link sidebar-link sidebar-page" aria-label="Pcå¯„å­˜å™¨"><!---->Pcå¯„å­˜å™¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/jvm/layout/stacks.html" class="nav-link sidebar-link sidebar-page" aria-label="è™šæ‹Ÿæœºæ ˆ"><!---->è™šæ‹Ÿæœºæ ˆ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/jvm/layout/Frames.html" class="nav-link sidebar-link sidebar-page" aria-label="æ ˆå¸§"><!---->æ ˆå¸§<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/jvm/layout/share-data.html" class="nav-link sidebar-link sidebar-page" aria-label="å…±äº«æ•°æ®"><!---->å…±äº«æ•°æ®<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/jvm/jvm-select.html" class="nav-link sidebar-link sidebar-page" aria-label="jvm-select"><!---->jvm-select<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/jvm/SerialHeap.html" class="nav-link sidebar-link sidebar-page" aria-label="SerialHeap"><!---->SerialHeap<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/jvm/safepoint.html" class="nav-link sidebar-link sidebar-page" aria-label="safepoint"><!---->safepoint<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/jvm/jvm-select-use.html" class="nav-link sidebar-link sidebar-page" aria-label="ç”Ÿäº§ä½¿ç”¨"><!---->ç”Ÿäº§ä½¿ç”¨<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">å¤šçº¿ç¨‹ç¼–ç¨‹</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/languages/java/thread/java/juc/read-me.html" class="nav-link sidebar-link sidebar-page" aria-label="å¤šçº¿ç¨‹ç¼–ç¨‹"><!---->å¤šçº¿ç¨‹ç¼–ç¨‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/thread/java/juc/aos.html" class="nav-link sidebar-link sidebar-page" aria-label="exclusively"><!---->exclusively<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/thread/java/juc/atomic.html" class="nav-link sidebar-link sidebar-page" aria-label="cas"><!---->cas<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/thread/java/juc/aqs.html" class="nav-link sidebar-link sidebar-page" aria-label="aqs"><!---->aqs<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/thread/java/juc/blocking.html" class="nav-link sidebar-link sidebar-page" aria-label="LockSupport"><!---->LockSupport<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/thread/java/juc/clh.html" class="nav-link sidebar-link sidebar-page" aria-label="clhé”"><!---->clhé”<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/thread/java/juc/condition.html" class="nav-link sidebar-link sidebar-page" aria-label="Condition"><!---->Condition<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/thread/java/juc/future.html" class="nav-link sidebar-link sidebar-page" aria-label="FutureTask"><!---->FutureTask<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/thread/java/juc/daemon.html" class="nav-link sidebar-link sidebar-page" aria-label="daemon"><!---->daemon<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/thread/java/juc/thread-factory.html" class="nav-link sidebar-link sidebar-page" aria-label="ThreadFactory"><!---->ThreadFactory<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/thread/java/juc/rejected-execution-handler.html" class="nav-link sidebar-link sidebar-page" aria-label="ExecutionPolicy"><!---->ExecutionPolicy<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/thread/java/juc/work.html" class="nav-link sidebar-link sidebar-page" aria-label="Worker"><!---->Worker<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/thread/java/juc/thread-pool-executor.html" class="nav-link sidebar-link sidebar-page" aria-label="ThreadPoolExecutor"><!---->ThreadPoolExecutor<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/thread/java/juc/threadQ.html" class="nav-link sidebar-link sidebar-page" aria-label="çº¿ç¨‹æ± é¢è¯•é¢˜"><!---->çº¿ç¨‹æ± é¢è¯•é¢˜<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">å…¶ä»–</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/languages/java/auto-box.html" class="nav-link sidebar-link sidebar-page" aria-label="è‡ªåŠ¨è£…ç®±"><!---->è‡ªåŠ¨è£…ç®±<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/delay-queue.html" class="nav-link sidebar-link sidebar-page" aria-label="é”å±€éƒ¨å˜é‡"><!---->é”å±€éƒ¨å˜é‡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/introduction-to-java-bytecode.html" class="nav-link sidebar-link sidebar-page" aria-label="åŸºäºæ ˆçš„æŒ‡ä»¤é›†"><!---->åŸºäºæ ˆçš„æŒ‡ä»¤é›†<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/languages/java/heap-java.html" class="nav-link sidebar-link sidebar-page" aria-label="Heapæºç "><!---->Heapæºç <!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">go</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/languages/go/heap-go.html" class="nav-link sidebar-link sidebar-page" aria-label="Heapæºç "><!---->Heapæºç <!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">åŸºæœ¬åŠŸ</span><!----></p><ul class="sidebar-links"><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/basic-skill/algorithms" class="title">ç®—æ³•</a><!----></p><ul class="sidebar-links"><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/basic-skill/algorithms/sort/sort.html" class="title">æ’åº</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/basic-skill/algorithms/sort/bubble-sort.html" class="nav-link sidebar-link sidebar-page" aria-label="å†’æ³¡æ’åº"><!---->å†’æ³¡æ’åº<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/algorithms/sort/select-sort.html" class="nav-link sidebar-link sidebar-page" aria-label="é€‰æ‹©æ’åº"><!---->é€‰æ‹©æ’åº<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/algorithms/sort/insert-sort.html" class="nav-link sidebar-link sidebar-page" aria-label="æ’å…¥æ’åº"><!---->æ’å…¥æ’åº<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/algorithms/sort/merge-sort.html" class="nav-link sidebar-link sidebar-page" aria-label="å½’å¹¶æ’åº"><!---->å½’å¹¶æ’åº<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/algorithms/sort/quick-sort.html" class="nav-link sidebar-link sidebar-page" aria-label="å¿«é€Ÿæ’åº"><!---->å¿«é€Ÿæ’åº<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">æ•°æ®ç»“æ„</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/basic-skill/algorithms/structure/union-find-structure.html" class="nav-link sidebar-link sidebar-page" aria-label="å¹¶æŸ¥é›†"><!---->å¹¶æŸ¥é›†<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/basic-skill/algorithms/tree/binary-tree-concept.html" class="title">Tree</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/basic-skill/algorithms/tree/pre-order.html" class="nav-link sidebar-link sidebar-page" aria-label="å‰åºéå†"><!---->å‰åºéå†<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/algorithms/tree/binary-tree-algs4.html" class="nav-link sidebar-link sidebar-page" aria-label="äºŒå‰æ ‘-ç®—æ³•4"><!---->äºŒå‰æ ‘-ç®—æ³•4<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/algorithms/tree/balanced-search-trees.html" class="nav-link sidebar-link sidebar-page" aria-label="2-3-æœç´¢æ ‘"><!---->2-3-æœç´¢æ ‘<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/algorithms/heap/heap.html" class="nav-link sidebar-link sidebar-page" aria-label="Heap"><!---->Heap<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/basic-skill/algorithms/graphs/" class="title">å›¾</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/basic-skill/algorithms/graphs/graph-concept.html" class="nav-link sidebar-link sidebar-page" aria-label="æ¦‚å¿µ"><!---->æ¦‚å¿µ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/algorithms/graphs/directed-graph.html" class="nav-link sidebar-link sidebar-page" aria-label="æœ‰å‘å›¾"><!---->æœ‰å‘å›¾<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/algorithms/graphs/graph-search.html" class="nav-link sidebar-link sidebar-page" aria-label="æœç´¢"><!---->æœç´¢<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/algorithms/graphs/minimum-spanning-tree.html" class="nav-link sidebar-link sidebar-page" aria-label="æœ€å°ç”Ÿæˆæ ‘"><!---->æœ€å°ç”Ÿæˆæ ‘<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/algorithms/graphs/shortest-path-algnorithms.html" class="nav-link sidebar-link sidebar-page" aria-label="æœ€çŸ­è·¯å¾„ç®—æ³•"><!---->æœ€çŸ­è·¯å¾„ç®—æ³•<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">å…¶ä»–</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/basic-skill/algorithms/other/Edsger-Dijkstra.html" class="nav-link sidebar-link sidebar-page" aria-label="è·å…°å›½æ——"><!---->è·å…°å›½æ——<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/algorithms/other/binary-Search.html" class="nav-link sidebar-link sidebar-page" aria-label="äºŒåˆ†æŸ¥æ‰¾æ³•"><!---->äºŒåˆ†æŸ¥æ‰¾æ³•<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/algorithms/other/swap-or-exchange.html" class="nav-link sidebar-link sidebar-page" aria-label="äº¤æ¢è¿˜æ˜¯ç§»åŠ¨ï¼Ÿ"><!---->äº¤æ¢è¿˜æ˜¯ç§»åŠ¨ï¼Ÿ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/algorithms/other/xor.html" class="nav-link sidebar-link sidebar-page" aria-label="Xor"><!---->Xor<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/basic-skill/design-pattern/" class="title">è®¾è®¡æ¨¡å¼</a><!----></p><ul class="sidebar-links"><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/basic-skill/design-pattern/reactor" class="title">Reactor</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/basic-skill/design-pattern/reactor/single.html" class="nav-link sidebar-link sidebar-page" aria-label="Single"><!---->Single<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/design-pattern/reactor/multiple.html" class="nav-link sidebar-link sidebar-page" aria-label="Multiple"><!---->Multiple<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">å•ä¾‹</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/basic-skill/design-pattern/create/singleton/" class="nav-link sidebar-link sidebar-page" aria-label="Singleton"><!---->Singleton<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/design-pattern/create/singleton/singleton.html" class="nav-link sidebar-link sidebar-page" aria-label="Springå•ä¾‹beanå¯¹jvmçš„å½±å“"><!---->Springå•ä¾‹beanå¯¹jvmçš„å½±å“<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">ç­–ç•¥</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/basic-skill/design-pattern/policy/spring-error-demo.html" class="nav-link sidebar-link sidebar-page" aria-label="é”™è¯¯æ¡ˆä¾‹"><!---->é”™è¯¯æ¡ˆä¾‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/design-pattern/policy/spring-policy.html" class="nav-link sidebar-link sidebar-page" aria-label="ç­–ç•¥æ¨¡å¼"><!---->ç­–ç•¥æ¨¡å¼<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/design-pattern/policy/spring-fly-weight.html" class="nav-link sidebar-link sidebar-page" aria-label="ç­–ç•¥+äº«å…ƒ"><!---->ç­–ç•¥+äº«å…ƒ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><!--[--><a href="/basic-skill/design-pattern/interpreter/interpreter-pattern.html" class="nav-link sidebar-link sidebar-page" aria-label="interpreter"><!---->interpreter<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/basic-skill/design-pattern/structure/decorator/concept.html" class="title">è£…é¥°è€…</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/basic-skill/design-pattern/structure/decorator/decorator-java.html" class="nav-link sidebar-link sidebar-page" aria-label="Decorator-Java"><!---->Decorator-Java<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/design-pattern/structure/decorator/decorator-netty.html" class="nav-link sidebar-link sidebar-page" aria-label="Decorator-Netty"><!---->Decorator-Netty<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/design-pattern/structure/decorator/decorator-hystrix.html" class="nav-link sidebar-link sidebar-page" aria-label="Decorator-Hystrix"><!---->Decorator-Hystrix<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">è®¡ç®—æœºç½‘ç»œ</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/basic-skill/network/tree-shake-hands.html" class="nav-link sidebar-link sidebar-page" aria-label="ä¸‰æ¬¡æ¡æ‰‹"><!---->ä¸‰æ¬¡æ¡æ‰‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/basic-skill/network/four-wave.html" class="nav-link sidebar-link sidebar-page" aria-label="å››æ¬¡æŒ¥æ‰‹"><!---->å››æ¬¡æŒ¥æ‰‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">é¡¹ç›®</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/project/selectAll/rbac/" class="nav-link sidebar-link sidebar-page" aria-label="RBAC"><!---->RBAC<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/project/selectAll/nextflow.html" class="nav-link sidebar-link sidebar-page" aria-label="æƒé™+æµç¨‹"><!---->æƒé™+æµç¨‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/project/cicd/docker/" class="nav-link sidebar-link sidebar-page" aria-label="dockeræ”¯æŒè¯­è¨€ä¸€è§ˆ"><!---->dockeræ”¯æŒè¯­è¨€ä¸€è§ˆ<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/project/cicd/docker/buildimage.html" class="nav-link sidebar-link sidebar-page" aria-label="dockeré•œåƒæ„å»º"><!---->dockeré•œåƒæ„å»º<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li><li><section class="sidebar-group"><p class="sidebar-heading clickable"><!----><a href="/tools/" class="title">å·¥å…·ç¯‡</a><!----></p><ul class="sidebar-links"><li><!--[--><a href="/tools/draw.html" class="nav-link sidebar-link sidebar-page" aria-label="ç”»å›¾å·¥å…·"><!---->ç”»å›¾å·¥å…·<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/tools/flowable.html" class="nav-link sidebar-link sidebar-page" aria-label="å·¥ä½œæµè®¾è®¡"><!---->å·¥ä½œæµè®¾è®¡<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a href="/tools/linked/" class="nav-link sidebar-link sidebar-page" aria-label="èµ„æºå½’æ¡£"><!---->èµ„æºå½’æ¡£<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><!---->å¥—åˆ©</h1><div class="page-info"><!----><!----><span class="page-word-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 2183 å­—</span><meta property="wordCount" content="2183"></span><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 7 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT7M"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹<button class="print-button" title="print"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button></div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/web3/arb.html#å¯åŠ¨ç¨‹åº" class="router-link-active router-link-exact-active toc-link level2">å¯åŠ¨ç¨‹åº</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web3/arb.html#å…¨å±€ç»‘å®šä¸‰è€…å…³ç³»" class="router-link-active router-link-exact-active toc-link level2">å…¨å±€ç»‘å®šä¸‰è€…å…³ç³»</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web3/arb.html#ç›‘å¬è€…" class="router-link-active router-link-exact-active toc-link level2">ç›‘å¬è€…</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web3/arb.html#æ± å­æŸ¥è¯¢" class="router-link-active router-link-exact-active toc-link level2">æ± å­æŸ¥è¯¢</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web3/arb.html#å¥—åˆ©ç»‘å®šä»£ç " class="router-link-active router-link-exact-active toc-link level2">å¥—åˆ©ç»‘å®šä»£ç </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web3/arb.html#åˆçº¦ä»£ç " class="router-link-active router-link-exact-active toc-link level2">åˆçº¦ä»£ç </a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/web3/arb.html#æ€»ç»“" class="router-link-active router-link-exact-active toc-link level2">æ€»ç»“</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><h1 id="å¥—åˆ©" tabindex="-1"><a class="header-anchor" href="#å¥—åˆ©" aria-hidden="true">#</a> å¥—åˆ©</h1><p><a href="https://github.com/rfk1118/simple-blind-arbitrage/tree/main" target="_blank" rel="noopener noreferrer">ä»£ç åœ°å€<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="å¯åŠ¨ç¨‹åº" tabindex="-1"><a class="header-anchor" href="#å¯åŠ¨ç¨‹åº" aria-hidden="true">#</a> å¯åŠ¨ç¨‹åº</h2><p>å¯åŠ¨ç¨‹åºä¸»è¦åŒ…å«ä¸‰ä¸ªç»´åº¦é“¾ä¸‹ä»£ç ï¼š</p><ul><li>ç›‘å¬è€…</li><li>æ± å­æŸ¥è¯¢</li><li>å¥—åˆ©ç»‘å®šä»£ç </li></ul><h2 id="å…¨å±€ç»‘å®šä¸‰è€…å…³ç³»" tabindex="-1"><a class="header-anchor" href="#å…¨å±€ç»‘å®šä¸‰è€…å…³ç³»" aria-hidden="true">#</a> å…¨å±€ç»‘å®šä¸‰è€…å…³ç³»</h2><p>è¿™ä¸€æ®µä¹Ÿå«ä¸Šå¸ä»£ç ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// è§£ææ•°æ®</span>
<span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">parse</span><span class="token punctuation">(</span>event<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;New transaction with hash:&quot;</span><span class="token punctuation">,</span> data<span class="token punctuation">.</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// å¦‚æœæ²¡æœ‰æ•°æ®</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>logs <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Loop through all the logs in the transaction</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Transaction has logs, parsing them&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> data<span class="token punctuation">.</span>logs<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>logs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// åˆ¤æ–­æ˜¯å¦æ˜¯swapä¸»é¢˜</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token punctuation">.</span>logs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>topics<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">!=</span> config<span class="token punctuation">.</span>syncTopic<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">continue</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token comment">// Skip if it isn&#39;t a sync event</span>
  <span class="token comment">// è·å–ç¬¬ä¸€ä¸ªäº¤æ˜“æ± å­</span>
  <span class="token keyword">const</span> firstPair <span class="token operator">=</span> data<span class="token punctuation">.</span>logs<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>address<span class="token punctuation">;</span> <span class="token comment">// Get the address of the first pair, which is the address the logs are coming from</span>

  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    <span class="token string">&quot;Transaction trading on Uniswap v2 pool detected! Pool address:&quot;</span><span class="token punctuation">,</span>
    firstPair
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// æ ¹æ®ç¬¬ä¸€ä¸ªpairåˆ¤æ–­æ˜¯å¦å­˜åœ¨æ± å­</span>
  <span class="token keyword">const</span> <span class="token punctuation">[</span>token0<span class="token punctuation">,</span> token1<span class="token punctuation">,</span> factoryToCheck<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> poolManager<span class="token punctuation">.</span><span class="token function">checkPool</span><span class="token punctuation">(</span>
    firstPair
  <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Get the pool and the other factory we need to check</span>
  <span class="token comment">// æœªæ‰¾åˆ°æ± å­</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>token0 <span class="token operator">==</span> <span class="token boolean">false</span> <span class="token operator">||</span> token1 <span class="token operator">==</span> <span class="token boolean">false</span> <span class="token operator">||</span> factoryToCheck <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token comment">// These are false if the pool does not have a WETH pair</span>

  <span class="token comment">// è·å–åˆ°ç¬¬äºŒä¸ªæ± å­</span>
  <span class="token keyword">const</span> secondPair <span class="token operator">=</span> <span class="token keyword">await</span> poolManager<span class="token punctuation">.</span><span class="token function">checkFactory</span><span class="token punctuation">(</span>
    factoryToCheck<span class="token punctuation">,</span>
    token0<span class="token punctuation">,</span>
    token1
  <span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Check if the other factory has the pool too</span>
  <span class="token comment">// æ²¡æœ‰å¥—åˆ©çš„æ± å­</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>secondPair <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token comment">// If it doesn&#39;t, stop here</span>

  <span class="token comment">// è¿›è¡Œå¥—åˆ©</span>
  <span class="token keyword">await</span> bundleExecutor<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>firstPair<span class="token punctuation">,</span> secondPair<span class="token punctuation">,</span> data<span class="token punctuation">.</span>hash<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Execute the bundle if we&#39;ve made it this far</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç›‘å¬è€…" tabindex="-1"><a class="header-anchor" href="#ç›‘å¬è€…" aria-hidden="true">#</a> ç›‘å¬è€…</h2><p>ä¸»è¦ä¸º<code>MevShareNode</code>ï¼Œè¿™é‡Œä¹Ÿå°±æ˜¯è§‚å¯Ÿè€…è®¾è®¡æ¨¡å¼ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯éœ€è¦ç›‘å¬æ± å­<code>pendingæ•°æ®</code>ï¼Œæ ¸å¿ƒä»£ç å¦‚ä¸‹ï¼Œåˆ›å»ºè§‚å¯Ÿè€…ï¼Œ <img src="/assets/pending-e703f17f.png" alt="An image"></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>    MevShareNode <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventSource</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>mainnetMevShareNode<span class="token punctuation">)</span>
    <span class="token comment">// æœ‰äº‹ä»¶å‘ç”Ÿ</span>
    MevShareNode<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">event</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">;</span>
    MevShareNode<span class="token punctuation">.</span><span class="token function-variable function">onerror</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token comment">// Handle the error</span>
        console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ± å­æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#æ± å­æŸ¥è¯¢" aria-hidden="true">#</a> æ± å­æŸ¥è¯¢</h2><p>è¿™é‡Œä¸»è¦ç”¨çš„uniswapå’ŒSushiè¿›è¡Œå¥—åˆ©ã€‚</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>
<span class="token keyword">class</span> <span class="token class-name">PoolManager</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">_provider<span class="token punctuation">,</span> _network</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>provider <span class="token operator">=</span> _provider
        <span class="token comment">// æ ¹æ®ç½‘ç»œæ‹¿ä¸åŒçš„åœ°å€</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>_network <span class="token operator">==</span> <span class="token string">&#39;mainnet&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>UniswapFactoryAddress <span class="token operator">=</span> config<span class="token punctuation">.</span>mainnetUniswapFactoryAddress
            <span class="token keyword">this</span><span class="token punctuation">.</span>SushiFactoryAddress <span class="token operator">=</span> config<span class="token punctuation">.</span>mainnetSushiFactoryAddress
            <span class="token keyword">this</span><span class="token punctuation">.</span>WETHAddress <span class="token operator">=</span> config<span class="token punctuation">.</span>mainnetWETHAddress
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>_network <span class="token operator">==</span> <span class="token string">&#39;goerli&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>UniswapFactoryAddress <span class="token operator">=</span> config<span class="token punctuation">.</span>goerliUniswapFactoryAddress
            <span class="token keyword">this</span><span class="token punctuation">.</span>SushiFactoryAddress <span class="token operator">=</span> config<span class="token punctuation">.</span>goerliSushiFactoryAddress
            <span class="token keyword">this</span><span class="token punctuation">.</span>WETHAddress <span class="token operator">=</span> config<span class="token punctuation">.</span>goerliWETHAddress
        <span class="token punctuation">}</span>

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;PoolManager initialized for network:&quot;</span><span class="token punctuation">,</span> _network<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">checkPool</span><span class="token punctuation">(</span><span class="token parameter">_address</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Create an ethers contract object for the pool</span>
        <span class="token comment">// æ ¹æ®æ± å­åœ°å€é“¾æ¥åˆ°åˆçº¦</span>
        <span class="token keyword">const</span> poolContract <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ethers<span class="token punctuation">.</span>Contract</span><span class="token punctuation">(</span>_address<span class="token punctuation">,</span> poolABI<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>provider<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Pool contract created, getting tokens&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">// æ‹¿åˆ°ä¸¤ä¸ªä»£å¸çš„æ•°é‡</span>
        <span class="token keyword">const</span> token0 <span class="token operator">=</span> <span class="token keyword">await</span> poolContract<span class="token punctuation">.</span><span class="token function">token0</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> token1 <span class="token operator">=</span> <span class="token keyword">await</span> poolContract<span class="token punctuation">.</span><span class="token function">token1</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Token0:&quot;</span><span class="token punctuation">,</span> token0<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Token1:&quot;</span><span class="token punctuation">,</span> token1<span class="token punctuation">)</span>

        <span class="token comment">// æ‰¾åˆ°å±äºé‚£ä¸ªswap</span>
        <span class="token keyword">const</span> factory <span class="token operator">=</span> <span class="token keyword">await</span> poolContract<span class="token punctuation">.</span><span class="token function">factory</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Factory:&quot;</span><span class="token punctuation">,</span> factory<span class="token punctuation">)</span>
        <span class="token comment">// ä¸æ˜¯ethä¸ºæœ¬ä½çš„è·³è¿‡</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>token0 <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>WETHAddress <span class="token operator">||</span> token1 <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>WETHAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// è¿™é‡Œçš„è¿”å›å¾ˆæœ‰æ„æ€ï¼Œå› ä¸ºåç»­éœ€è¦å¦å¤–ä¸€ä¸ªå·¥å‚æŸ¥æ‰¾æ± å­</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Pool is WETH pair&quot;</span><span class="token punctuation">)</span>
            <span class="token comment">// å¦‚æœä¸ºuniswapçš„è¯è¿”å›sui</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>factory <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>UniswapFactoryAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Pool is Uniswap v2&quot;</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token punctuation">[</span>token0<span class="token punctuation">,</span> token1<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>SushiFactoryAddress<span class="token punctuation">]</span>
            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
                <span class="token comment">// å¦‚æœä¸ºsuiçš„è¯è¿”å›uniswap</span>
                console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Pool is Sushiswap&quot;</span><span class="token punctuation">)</span>
                <span class="token keyword">return</span> <span class="token punctuation">[</span>token0<span class="token punctuation">,</span> token1<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>UniswapFactoryAddress<span class="token punctuation">]</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Pool is not WETH pair, WETH address is:&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>WETHAddress<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token boolean">false</span><span class="token punctuation">]</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">async</span> <span class="token function">checkFactory</span> <span class="token punctuation">(</span><span class="token parameter">_factoryAddress<span class="token punctuation">,</span> _token0<span class="token punctuation">,</span> _token1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Create an ethers contract object for the factory</span>
        <span class="token comment">// åˆ›å»ºå·¥å‚</span>
        <span class="token keyword">const</span> factoryContract <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ethers<span class="token punctuation">.</span>Contract</span><span class="token punctuation">(</span>_factoryAddress<span class="token punctuation">,</span> factoryABI<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>provider<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Checking alternative factor for pair&quot;</span><span class="token punctuation">)</span>
        <span class="token comment">// æ ¹æ®ä»£å¸å¯¹æŸ¥æ‰¾æ± å­</span>

        <span class="token keyword">const</span> pair <span class="token operator">=</span> <span class="token keyword">await</span> factoryContract<span class="token punctuation">.</span><span class="token function">getPair</span><span class="token punctuation">(</span>_token0<span class="token punctuation">,</span> _token1<span class="token punctuation">)</span>
        <span class="token comment">// æœªæ‰¾åˆ°æ± å­</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pair <span class="token operator">==</span> <span class="token string">&quot;0x0000000000000000000000000000000000000000&quot;</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Pair does not exist on alternative factory, returning&quot;</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
           <span class="token comment">// è¿”å›æ± å­</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Alternate pair exists! Pair address:&quot;</span><span class="token punctuation">,</span> pair<span class="token punctuation">)</span>
            <span class="token keyword">return</span> pair
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> PoolManager
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="å¥—åˆ©ç»‘å®šä»£ç " tabindex="-1"><a class="header-anchor" href="#å¥—åˆ©ç»‘å®šä»£ç " aria-hidden="true">#</a> å¥—åˆ©ç»‘å®šä»£ç </h2><p>ä¸»è¦æŸ¥çœ‹buildBundlesæ–¹æ³•</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code>
<span class="token keyword">class</span> <span class="token class-name">BundleExecutor</span> <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">_signer<span class="token punctuation">,</span> _flashbotsBundleProvider<span class="token punctuation">,</span> _contractAddress<span class="token punctuation">,</span> _bundleAPI<span class="token punctuation">,</span> _percentageToKeep</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// é’±åŒ…</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>signer <span class="token operator">=</span> _signer
        <span class="token comment">// flashbot Rpc</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>flashBotsBundleProvider <span class="token operator">=</span> _flashbotsBundleProvider
        <span class="token comment">// å¥—åˆ©çš„åˆçº¦ä»£ç </span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>contract <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ethers<span class="token punctuation">.</span>Contract</span><span class="token punctuation">(</span>_contractAddress<span class="token punctuation">,</span> blindBackrunJSON<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>signer<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>connectionInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">url</span><span class="token operator">:</span> _bundleAPI<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>nextID <span class="token operator">=</span> <span class="token number">1</span>
        <span class="token comment">// ç»™çŸ¿å·¥çš„é’±</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>percentageToKeep <span class="token operator">=</span> _percentageToKeep

        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Successfully created BundleExecutor&#39;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Executes arbitrage by sending bundles to the MEV-Share Node for a given transaction hash.
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span> <span class="token parameter">_firstPair</span> - The first pair&#39;s address.
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span> <span class="token parameter">_secondPair</span> - The second pair&#39;s address.
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span> <span class="token parameter">_txHash</span> - The transaction hash to execute the bundles on.
     */</span>
    <span class="token keyword">async</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token parameter">_firstPair<span class="token punctuation">,</span> _secondPair<span class="token punctuation">,</span> _txHash</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Sending bundles to MEV-Share Node for tx:&quot;</span><span class="token punctuation">,</span> _txHash<span class="token punctuation">)</span>
        <span class="token comment">// åˆ›å»ºtx</span>
        <span class="token keyword">const</span> <span class="token punctuation">[</span>bundleOneWithParams<span class="token punctuation">,</span> bundleTwoWithParams<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">buildBundles</span><span class="token punctuation">(</span>_firstPair<span class="token punctuation">,</span> _secondPair<span class="token punctuation">,</span> _txHash<span class="token punctuation">)</span>
        <span class="token comment">// è·å–ç»“æœ</span>
        <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendBundleToNode</span><span class="token punctuation">(</span>bundleOneWithParams<span class="token punctuation">,</span> bundleTwoWithParams<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Sends bundles to the MEV-Share Node.
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Object<span class="token punctuation">}</span></span> <span class="token parameter">_bundleOneWithParams</span> - The first bundle with parameters.
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Object<span class="token punctuation">}</span></span> <span class="token parameter">_bundleTwoWithParams</span> - The second bundle with parameters.
     */</span>
    <span class="token keyword">async</span> <span class="token function">sendBundleToNode</span><span class="token punctuation">(</span><span class="token parameter">_bundleOneWithParams<span class="token punctuation">,</span> _bundleTwoWithParams</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">await</span> Promise<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token punctuation">[</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendBundle</span><span class="token punctuation">(</span>_bundleOneWithParams<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">sendBundle</span><span class="token punctuation">(</span>_bundleTwoWithParams<span class="token punctuation">)</span>
        <span class="token punctuation">]</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// At the moment this function isn&#39;t used at all because the MEV-Share Node doesn&#39;t support simulation against searcher bundles yet.</span>
    <span class="token keyword">async</span> <span class="token function">simBundle</span><span class="token punctuation">(</span><span class="token parameter">_bundle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prepareRelayRequest</span><span class="token punctuation">(</span><span class="token punctuation">[</span>_bundle<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;mev_simBundle&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        <span class="token keyword">return</span> response
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Sends a bundle.
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Object<span class="token punctuation">}</span></span> <span class="token parameter">_bundle</span> - The bundle to sending.
     * <span class="token keyword">@returns</span> <span class="token class-name"><span class="token punctuation">{</span>Promise<span class="token punctuation">&lt;</span>Object<span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span> The response from sending the bundle.
     */</span>
    <span class="token keyword">async</span> <span class="token function">sendBundle</span><span class="token punctuation">(</span><span class="token parameter">_bundle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">const</span> request <span class="token operator">=</span> <span class="token constant">JSON</span><span class="token punctuation">.</span><span class="token function">stringify</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">prepareRelayRequest</span><span class="token punctuation">(</span><span class="token punctuation">[</span>_bundle<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">&#39;mev_sendBundle&#39;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>request<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;response:&quot;</span><span class="token punctuation">,</span> response<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Prepares a relay request with the given method and parameters.
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Array<span class="token punctuation">}</span></span> <span class="token parameter">_params</span> - The parameters for the relay request.
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span> <span class="token parameter">_method</span> - The method for the relay request.
     * <span class="token keyword">@returns</span> <span class="token class-name"><span class="token punctuation">{</span>Object<span class="token punctuation">}</span></span> The prepared relay request.
     */</span>
    <span class="token function">prepareRelayRequest</span><span class="token punctuation">(</span><span class="token parameter">_params<span class="token punctuation">,</span> _method</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">method</span><span class="token operator">:</span> _method<span class="token punctuation">,</span>
            <span class="token literal-property property">params</span><span class="token operator">:</span> _params<span class="token punctuation">,</span>
            <span class="token literal-property property">id</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nextID<span class="token operator">++</span><span class="token punctuation">,</span>
            <span class="token literal-property property">jsonrpc</span><span class="token operator">:</span> <span class="token string">&#39;2.0&#39;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Sends a request with the specified payload.
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span> <span class="token parameter">_request</span> - The request payload.
     * <span class="token keyword">@returns</span> <span class="token class-name"><span class="token punctuation">{</span>Promise<span class="token punctuation">&lt;</span>Object<span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span> The response from the request.
     */</span>
    <span class="token keyword">async</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token parameter">_request</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>connectionInfo<span class="token punctuation">.</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token string-property property">&#39;X-Flashbots-Signature&#39;</span><span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>signer<span class="token punctuation">.</span>address<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">:</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>signer<span class="token punctuation">.</span><span class="token function">signMessage</span><span class="token punctuation">(</span>ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">id</span><span class="token punctuation">(</span>_request<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span>
        <span class="token punctuation">}</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Making request:&quot;</span><span class="token punctuation">,</span> _request<span class="token punctuation">)</span>
        <span class="token keyword">let</span> resp <span class="token operator">=</span> <span class="token keyword">await</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">fetchJson</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>connectionInfo<span class="token punctuation">,</span> _request<span class="token punctuation">)</span>
        <span class="token keyword">return</span> resp
      <span class="token punctuation">}</span>

      <span class="token doc-comment comment">/**
     * Builds bundles for the given pair addresses and transaction hash.
     * <span class="token keyword">@dev</span> This function outputs two bundles, one for each potential trade direction. Only one will succeed depending on the direction of the user&#39;s trade.
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span> <span class="token parameter">_firstPair</span> - The first pair&#39;s address.
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span> <span class="token parameter">_secondPair</span> - The second pair&#39;s address.
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>string<span class="token punctuation">}</span></span> <span class="token parameter">_txHash</span> - The transaction hash to backrun.
     * <span class="token keyword">@returns</span> <span class="token class-name"><span class="token punctuation">{</span>Promise<span class="token punctuation">&lt;</span>Array<span class="token punctuation">&gt;</span><span class="token punctuation">}</span></span> An array containing two bundles backrunning the user&#39;s _txHash.
     */</span>
    <span class="token keyword">async</span> <span class="token function">buildBundles</span><span class="token punctuation">(</span><span class="token parameter">_firstPair<span class="token punctuation">,</span> _secondPair<span class="token punctuation">,</span> _txHash</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// è·å–blockNumber</span>
        <span class="token keyword">let</span> blockNumber <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>signer<span class="token punctuation">.</span>provider<span class="token punctuation">.</span><span class="token function">getBlockNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Current block number:&quot;</span><span class="token punctuation">,</span> blockNumber<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Building bundles&quot;</span><span class="token punctuation">)</span>

        <span class="token comment">// å¯ä»¥å¡«çš„å‚æ•°</span>
        <span class="token keyword">let</span> bundleTransactionOptions <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token comment">// gasä»·æ ¼</span>
            <span class="token literal-property property">gasPrice</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>signer<span class="token punctuation">.</span>provider<span class="token punctuation">.</span><span class="token function">getGasPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// This is *extremely* naive.</span>
            <span class="token comment">// é™åˆ¶</span>
            <span class="token literal-property property">gasLimit</span><span class="token operator">:</span> ethers<span class="token punctuation">.</span>BigNumber<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">400000</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token comment">// tx</span>
            <span class="token literal-property property">nonce</span><span class="token operator">:</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>signer<span class="token punctuation">.</span><span class="token function">getTransactionCount</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span>


        <span class="token comment">// ç¼–è¯‘åˆçº¦å‚æ•°ï¼Œä¸»è¦æ˜¯ç¬¬ä¸€ä¸ªæ± å­å’Œç¬¬äºŒä¸ªæ± å­</span>
        <span class="token keyword">const</span> types <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token string">&#39;address&#39;</span><span class="token punctuation">,</span>
            <span class="token string">&#39;address&#39;</span><span class="token punctuation">,</span>
            <span class="token string">&#39;uint256&#39;</span>
        <span class="token punctuation">]</span>

        <span class="token comment">// å‚æ•°</span>
        <span class="token keyword">const</span> valuesFirstTrade <span class="token operator">=</span> <span class="token punctuation">[</span>
            _firstPair<span class="token punctuation">,</span>
            _secondPair<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>percentageToKeep
        <span class="token punctuation">]</span>

        <span class="token keyword">let</span> paramsFirstTrade <span class="token operator">=</span> Web3EthAbi<span class="token punctuation">.</span><span class="token function">encodeParameters</span><span class="token punctuation">(</span>types<span class="token punctuation">,</span> valuesFirstTrade<span class="token punctuation">)</span>

        <span class="token comment">// ç¬¬ä¸€ä¸ªtx</span>
        <span class="token keyword">let</span> bundleOneTransaction <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>contract<span class="token punctuation">.</span>populateTransaction<span class="token punctuation">.</span><span class="token function">makeFlashLoan</span><span class="token punctuation">(</span>
            config<span class="token punctuation">.</span>mainnetWETHAddress<span class="token punctuation">,</span>
            ethers<span class="token punctuation">.</span>BigNumber<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">**</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            paramsFirstTrade<span class="token punctuation">,</span>
            bundleTransactionOptions
        <span class="token punctuation">)</span>

        <span class="token keyword">let</span> bundleOne <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token literal-property property">hash</span><span class="token operator">:</span> _txHash<span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token literal-property property">tx</span><span class="token operator">:</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>signer<span class="token punctuation">.</span><span class="token function">signTransaction</span><span class="token punctuation">(</span>bundleOneTransaction<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">canRevert</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>

        <span class="token keyword">const</span> valuesSecondTrade <span class="token operator">=</span> <span class="token punctuation">[</span>
            _secondPair<span class="token punctuation">,</span>
            _firstPair<span class="token punctuation">,</span>
            <span class="token keyword">this</span><span class="token punctuation">.</span>percentageToKeep
        <span class="token punctuation">]</span>

        <span class="token keyword">let</span> paramsSecondTrade <span class="token operator">=</span> Web3EthAbi<span class="token punctuation">.</span><span class="token function">encodeParameters</span><span class="token punctuation">(</span>types<span class="token punctuation">,</span> valuesSecondTrade<span class="token punctuation">)</span>

        <span class="token keyword">let</span> bundleTwoTransaction <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>contract<span class="token punctuation">.</span>populateTransaction<span class="token punctuation">.</span><span class="token function">makeFlashLoan</span><span class="token punctuation">(</span>
            config<span class="token punctuation">.</span>mainnetWETHAddress<span class="token punctuation">,</span>
            ethers<span class="token punctuation">.</span>BigNumber<span class="token punctuation">.</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">**</span><span class="token number">21</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            paramsSecondTrade<span class="token punctuation">,</span>
            bundleTransactionOptions
        <span class="token punctuation">)</span>

        <span class="token keyword">let</span> bundleTwo <span class="token operator">=</span> <span class="token punctuation">[</span>
            <span class="token punctuation">{</span><span class="token literal-property property">hash</span><span class="token operator">:</span> _txHash<span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">{</span><span class="token literal-property property">tx</span><span class="token operator">:</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>signer<span class="token punctuation">.</span><span class="token function">signTransaction</span><span class="token punctuation">(</span>bundleTwoTransaction<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token literal-property property">canRevert</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span>

        <span class="token comment">// è¿”å›ç¬¬äºŒä¸ªtx</span>
        <span class="token keyword">const</span> bundleOneWithParams <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bundleWithParams</span><span class="token punctuation">(</span>blockNumber <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> bundleOne<span class="token punctuation">)</span>
        <span class="token keyword">const</span> bundleTwoWithParams <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">bundleWithParams</span><span class="token punctuation">(</span>blockNumber <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">,</span> bundleTwo<span class="token punctuation">)</span>
        <span class="token keyword">return</span> <span class="token punctuation">[</span>bundleOneWithParams<span class="token punctuation">,</span> bundleTwoWithParams<span class="token punctuation">]</span>
    <span class="token punctuation">}</span>

    <span class="token doc-comment comment">/**
     * Adds parameters to a bundle for the given block number and blocks to try.
     * <span class="token keyword">@notice</span> The version number might need to change in the future. This is the only one that works at the moment.
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>number<span class="token punctuation">}</span></span> <span class="token parameter">_blockNumber</span> - The block number to submit initially for.
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>number<span class="token punctuation">}</span></span> <span class="token parameter">_blocksToTry</span> - The number of blocks to try.
     * <span class="token keyword">@param</span> <span class="token class-name"><span class="token punctuation">{</span>Array<span class="token punctuation">}</span></span> <span class="token parameter">_bundle</span> - The bundle to add parameters to.
     * <span class="token keyword">@returns</span> <span class="token class-name"><span class="token punctuation">{</span>Object<span class="token punctuation">}</span></span> The bundle with parameters.
     */</span>
    <span class="token function">bundleWithParams</span><span class="token punctuation">(</span><span class="token parameter">_blockNumber<span class="token punctuation">,</span> _blocksToTry<span class="token punctuation">,</span> _bundle</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Submitting bundles for block:&quot;</span><span class="token punctuation">,</span> _blockNumber<span class="token punctuation">,</span> <span class="token string">&quot;through block:&quot;</span><span class="token punctuation">,</span> _blockNumber <span class="token operator">+</span> _blocksToTry<span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;hexvalue    :&quot;</span><span class="token punctuation">,</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">hexValue</span><span class="token punctuation">(</span>_blockNumber<span class="token punctuation">)</span><span class="token punctuation">)</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Other method:&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;0x&quot;</span> <span class="token operator">+</span> _blockNumber<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

        <span class="token keyword">return</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">version</span><span class="token operator">:</span><span class="token string">&quot;beta-1&quot;</span><span class="token punctuation">,</span> <span class="token comment">//@NOTICE: This is the only version that works at the moment.</span>
            <span class="token literal-property property">inclusion</span><span class="token operator">:</span> <span class="token punctuation">{</span>
                <span class="token literal-property property">block</span><span class="token operator">:</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">hexValue</span><span class="token punctuation">(</span>_blockNumber<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token literal-property property">maxBlock</span><span class="token operator">:</span> ethers<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">hexValue</span><span class="token punctuation">(</span>_blockNumber <span class="token operator">+</span> _blocksToTry<span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token literal-property property">body</span><span class="token operator">:</span> _bundle<span class="token punctuation">,</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> BundleExecutor
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="åˆçº¦ä»£ç " tabindex="-1"><a class="header-anchor" href="#åˆçº¦ä»£ç " aria-hidden="true">#</a> åˆçº¦ä»£ç </h2><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code>contract BlindBackrun <span class="token keyword">is</span> BlindBackrunLogic <span class="token punctuation">{</span>
    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token constant">IWETH</span> _wethAddress<span class="token punctuation">)</span> <span class="token function">BlindBackrunLogic</span><span class="token punctuation">(</span>_wethAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>


    <span class="token comment">// æ‰§è¡Œå¥—åˆ©</span>
    <span class="token keyword">function</span> <span class="token function">executeArbitrage</span><span class="token punctuation">(</span>
        address firstPairAddress<span class="token punctuation">,</span>
        address secondPairAddress<span class="token punctuation">,</span>
        uint percentageToPayToCoinbase
    <span class="token punctuation">)</span> external onlyOwner <span class="token punctuation">{</span>
        <span class="token comment">// æ‰§è¡Œå¥—åˆ©</span>
        <span class="token function">_executeArbitrage</span><span class="token punctuation">(</span>firstPairAddress<span class="token punctuation">,</span> secondPairAddress<span class="token punctuation">,</span> percentageToPayToCoinbase<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">function</span> <span class="token function">withdrawWETHToOwner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> external onlyOwner <span class="token punctuation">{</span>
        uint256 balance <span class="token operator">=</span> <span class="token constant">WETH</span><span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token constant">WETH</span><span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> balance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">withdrawETHToOwner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> external onlyOwner <span class="token punctuation">{</span>
        uint256 balance <span class="token operator">=</span> <span class="token function">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span>balance<span class="token punctuation">;</span>
        <span class="token function">payable</span><span class="token punctuation">(</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">abstract</span> contract BlindBackrunLogic <span class="token keyword">is</span> Ownable <span class="token punctuation">{</span>
    uint256 constant uniswappyFee <span class="token operator">=</span> <span class="token number">997</span><span class="token punctuation">;</span>

    <span class="token comment">// æ„å»ºçš„æ—¶å€™è®¾ç½®wethåœ°å€</span>
    <span class="token constant">IWETH</span> <span class="token keyword">public</span> immutable <span class="token constant">WETH</span><span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token constant">IWETH</span> _wethAddress<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token constant">WETH</span> <span class="token operator">=</span> _wethAddress<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">_executeArbitrage</span><span class="token punctuation">(</span>
        address firstPairAddress<span class="token punctuation">,</span>
        address secondPairAddress<span class="token punctuation">,</span>
        uint percentageToPayToCoinbase
    <span class="token punctuation">)</span> internal <span class="token punctuation">{</span>
        <span class="token comment">// è®°å½•å½“å‰ä½™é¢</span>
        uint256 balanceBefore <span class="token operator">=</span> <span class="token constant">WETH</span><span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Starting balance  : %s&quot;</span><span class="token punctuation">,</span> balanceBefore<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// æ ¹æ®æ± å­è·å–ä»£å¸ä¿¡æ¯</span>
        IUniswapV2Pair firstPair <span class="token operator">=</span> <span class="token function">IUniswapV2Pair</span><span class="token punctuation">(</span>firstPairAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
        IUniswapV2Pair secondPair <span class="token operator">=</span> <span class="token function">IUniswapV2Pair</span><span class="token punctuation">(</span>secondPairAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\n--------- PAIR DATA ---------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è½¬æ¢æˆç»“æ„ä½“</span>
        IPairReserves<span class="token punctuation">.</span>PairReserves memory firstPairData <span class="token operator">=</span> <span class="token function">getPairData</span><span class="token punctuation">(</span>firstPair<span class="token punctuation">)</span><span class="token punctuation">;</span>
        IPairReserves<span class="token punctuation">.</span>PairReserves memory secondPairData <span class="token operator">=</span> <span class="token function">getPairData</span><span class="token punctuation">(</span>secondPair<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\n--------- PRICES ---------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;firstPair price   : %s&quot;</span><span class="token punctuation">,</span> firstPairData<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;secondPair price  : %s&quot;</span><span class="token punctuation">,</span> secondPairData<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// è·å–éœ€è¦å€Ÿè´·å¤šå°‘</span>
        uint256 amountIn <span class="token operator">=</span> <span class="token function">getAmountIn</span><span class="token punctuation">(</span>firstPairData<span class="token punctuation">,</span> secondPairData<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\n--------- TRADE AMOUNTS ---------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;amountIn          : %s&quot;</span><span class="token punctuation">,</span> amountIn<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// ä¼ è¾“ç»™ç¬¬ä¸€ä¸ªæ± å­</span>
        <span class="token constant">WETH</span><span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>firstPairAddress<span class="token punctuation">,</span> amountIn<span class="token punctuation">)</span><span class="token punctuation">;</span>

        uint256 firstPairAmountOut<span class="token punctuation">;</span>
        uint256 finalAmountOut<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>firstPairData<span class="token punctuation">.</span>isWETHZero <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// è®¡ç®—å‡ºå¯ä»¥æ¢å‡ºå¤šå°‘</span>
            firstPairAmountOut <span class="token operator">=</span> <span class="token function">getAmountOut</span><span class="token punctuation">(</span>amountIn<span class="token punctuation">,</span> firstPairData<span class="token punctuation">.</span>reserve0<span class="token punctuation">,</span> firstPairData<span class="token punctuation">.</span>reserve1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// è®¡ç®—å‡ºç¬¬äºŒä¸ªæ± å­å¯ä»¥æ¢å‡ºå¤šå°‘</span>
            finalAmountOut <span class="token operator">=</span> <span class="token function">getAmountOut</span><span class="token punctuation">(</span>firstPairAmountOut<span class="token punctuation">,</span> secondPairData<span class="token punctuation">.</span>reserve1<span class="token punctuation">,</span> secondPairData<span class="token punctuation">.</span>reserve0<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;firstPairAmountOut: %s&quot;</span><span class="token punctuation">,</span> firstPairAmountOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;finalAmountOut    : %s&quot;</span><span class="token punctuation">,</span> finalAmountOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;arb profit        : %s&quot;</span><span class="token punctuation">,</span> finalAmountOut <span class="token operator">-</span> amountIn<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\n--------- TRADING ---------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ç½®æ¢æˆä»£å¸</span>
            firstPair<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> firstPairAmountOut<span class="token punctuation">,</span> secondPairAddress<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;firstPair swap done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// ç½®æ¢æˆweth</span>
            secondPair<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span>finalAmountOut<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;secondPair swap done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            firstPairAmountOut <span class="token operator">=</span> <span class="token function">getAmountOut</span><span class="token punctuation">(</span>amountIn<span class="token punctuation">,</span> firstPairData<span class="token punctuation">.</span>reserve1<span class="token punctuation">,</span> firstPairData<span class="token punctuation">.</span>reserve0<span class="token punctuation">)</span><span class="token punctuation">;</span>
            finalAmountOut <span class="token operator">=</span> <span class="token function">getAmountOut</span><span class="token punctuation">(</span>firstPairAmountOut<span class="token punctuation">,</span> secondPairData<span class="token punctuation">.</span>reserve0<span class="token punctuation">,</span> secondPairData<span class="token punctuation">.</span>reserve1<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\n--------- TRADE AMOUNTS ---------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;amountIn          : %s&quot;</span><span class="token punctuation">,</span> amountIn<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;firstPairAmountOut: %s&quot;</span><span class="token punctuation">,</span> firstPairAmountOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;finalAmountOut    : %s&quot;</span><span class="token punctuation">,</span> finalAmountOut<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;arb profit        : %s&quot;</span><span class="token punctuation">,</span> finalAmountOut <span class="token operator">-</span> amountIn<span class="token punctuation">)</span><span class="token punctuation">;</span>

            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\n--------- TRADING ---------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            firstPair<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span>firstPairAmountOut<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> secondPairAddress<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;firstPair swap done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

            secondPair<span class="token punctuation">.</span><span class="token function">swap</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> finalAmountOut<span class="token punctuation">,</span> <span class="token function">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;secondPair swap done&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token comment">// æŸ¥çœ‹ä½™é¢</span>
        uint256 balanceAfter <span class="token operator">=</span> <span class="token constant">WETH</span><span class="token punctuation">.</span><span class="token function">balanceOf</span><span class="token punctuation">(</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>balanceAfter <span class="token operator">&gt;</span> balanceBefore<span class="token punctuation">,</span> <span class="token string">&quot;Arbitrage failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;\n--------- SUCCESS ---------&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Ending balance    : %s&quot;</span><span class="token punctuation">,</span> balanceAfter<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ç»™çŸ¿å·¥æ¯”ä¾‹</span>
        uint profit <span class="token operator">=</span> balanceAfter <span class="token operator">-</span> balanceBefore<span class="token punctuation">;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;Profit            : %s&quot;</span><span class="token punctuation">,</span> profit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// ææ¬¾</span>
        <span class="token constant">WETH</span><span class="token punctuation">.</span><span class="token function">withdraw</span><span class="token punctuation">(</span>profit<span class="token punctuation">)</span><span class="token punctuation">;</span>
        uint profitToCoinbase <span class="token operator">=</span> profit <span class="token operator">*</span> percentageToPayToCoinbase <span class="token operator">/</span> <span class="token number">100</span><span class="token punctuation">;</span>
        uint profitToCaller <span class="token operator">=</span> profit <span class="token operator">-</span> profitToCoinbase<span class="token punctuation">;</span>
        <span class="token comment">// ç»™çŸ¿å·¥çš„é’±</span>
        block<span class="token punctuation">.</span>coinbase<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>profitToCoinbase<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">payable</span><span class="token punctuation">(</span>tx<span class="token punctuation">.</span>origin<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>profitToCaller<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æ ¹æ®ä¸¤ä¸ªæ± å­ç®—å‡ºè¦å€Ÿå¤šå°‘é’±</span>
    <span class="token keyword">function</span> <span class="token function">getAmountIn</span><span class="token punctuation">(</span>
        IPairReserves<span class="token punctuation">.</span>PairReserves memory firstPairData<span class="token punctuation">,</span>
        IPairReserves<span class="token punctuation">.</span>PairReserves memory secondPairData
    <span class="token punctuation">)</span> <span class="token keyword">public</span> view <span class="token function">returns</span> <span class="token punctuation">(</span>uint256<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// ç®—æ³•ï¼Œéœ€è¦è¿›ä¸€æ­¥ç ”ç©¶</span>
        uint256 numerator <span class="token operator">=</span> <span class="token function">getNumerator</span><span class="token punctuation">(</span>firstPairData<span class="token punctuation">,</span> secondPairData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;numerator: %s&quot;</span><span class="token punctuation">,</span> numerator<span class="token punctuation">)</span><span class="token punctuation">;</span>
        uint256 denominator <span class="token operator">=</span> <span class="token function">getDenominator</span><span class="token punctuation">(</span>firstPairData<span class="token punctuation">,</span> secondPairData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;denominator: %s&quot;</span><span class="token punctuation">,</span> denominator<span class="token punctuation">)</span><span class="token punctuation">;</span>
        uint256 amountIn <span class="token operator">=</span>
            numerator
            <span class="token operator">*</span> <span class="token number">1000</span>
            <span class="token operator">/</span> denominator<span class="token punctuation">;</span>

        <span class="token keyword">return</span> amountIn<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ç®—æ³•ï¼Œéœ€è¦è¿›ä¸€æ­¥ç ”ç©¶</span>
    <span class="token keyword">function</span> <span class="token function">getNumerator</span><span class="token punctuation">(</span>
        IPairReserves<span class="token punctuation">.</span>PairReserves memory firstPairData<span class="token punctuation">,</span>
        IPairReserves<span class="token punctuation">.</span>PairReserves memory secondPairData
    <span class="token punctuation">)</span> <span class="token keyword">public</span> view <span class="token function">returns</span> <span class="token punctuation">(</span>uint256<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>firstPairData<span class="token punctuation">.</span>isWETHZero <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            uint presqrt <span class="token operator">=</span> uniswappyFee
                    <span class="token operator">*</span> uniswappyFee
                    <span class="token operator">*</span> firstPairData<span class="token punctuation">.</span>reserve1
                    <span class="token operator">*</span> secondPairData<span class="token punctuation">.</span>reserve0
                    <span class="token operator">/</span> secondPairData<span class="token punctuation">.</span>reserve1
                    <span class="token operator">/</span> firstPairData<span class="token punctuation">.</span>reserve0<span class="token punctuation">;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;presqrt: %s&quot;</span><span class="token punctuation">,</span> presqrt<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;sqrt(presqrt): %s&quot;</span><span class="token punctuation">,</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>presqrt<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            uint256 numerator <span class="token operator">=</span>
            <span class="token punctuation">(</span>
                <span class="token function">sqrt</span><span class="token punctuation">(</span>presqrt<span class="token punctuation">)</span>
                <span class="token operator">-</span> <span class="token number">1e3</span>
            <span class="token punctuation">)</span>
            <span class="token operator">*</span> secondPairData<span class="token punctuation">.</span>reserve1
            <span class="token operator">*</span> firstPairData<span class="token punctuation">.</span>reserve0<span class="token punctuation">;</span>

            <span class="token keyword">return</span> numerator<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            uint presqrt <span class="token operator">=</span> uniswappyFee
                <span class="token operator">*</span> uniswappyFee
                <span class="token operator">*</span> firstPairData<span class="token punctuation">.</span>reserve0
                <span class="token operator">*</span> secondPairData<span class="token punctuation">.</span>reserve1
                <span class="token operator">/</span> secondPairData<span class="token punctuation">.</span>reserve0
                <span class="token operator">/</span> firstPairData<span class="token punctuation">.</span>reserve1<span class="token punctuation">;</span>


            uint256 numerator <span class="token operator">=</span>
            <span class="token punctuation">(</span>
                <span class="token function">sqrt</span><span class="token punctuation">(</span>presqrt<span class="token punctuation">)</span>
                <span class="token operator">-</span> <span class="token number">1e3</span>
            <span class="token punctuation">)</span>
            <span class="token operator">*</span> secondPairData<span class="token punctuation">.</span>reserve0
            <span class="token operator">*</span> firstPairData<span class="token punctuation">.</span>reserve1<span class="token punctuation">;</span>

            <span class="token keyword">return</span> numerator<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// ç®—æ³•ï¼Œéœ€è¦è¿›ä¸€æ­¥ç ”ç©¶</span>
    <span class="token keyword">function</span> <span class="token function">getDenominator</span><span class="token punctuation">(</span>
            IPairReserves<span class="token punctuation">.</span>PairReserves memory firstPairData<span class="token punctuation">,</span>
            IPairReserves<span class="token punctuation">.</span>PairReserves memory secondPairData
        <span class="token punctuation">)</span> <span class="token keyword">public</span> pure <span class="token function">returns</span> <span class="token punctuation">(</span>uint256<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>firstPairData<span class="token punctuation">.</span>isWETHZero <span class="token operator">==</span> <span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            uint256 denominator <span class="token operator">=</span>
                <span class="token punctuation">(</span>
                    uniswappyFee
                    <span class="token operator">*</span> secondPairData<span class="token punctuation">.</span>reserve1
                    <span class="token operator">*</span> <span class="token number">1000</span>
                <span class="token punctuation">)</span>
                <span class="token operator">+</span> <span class="token punctuation">(</span>
                    uniswappyFee
                    <span class="token operator">*</span> uniswappyFee
                    <span class="token operator">*</span> firstPairData<span class="token punctuation">.</span>reserve1
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> denominator<span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            uint256 denominator <span class="token operator">=</span>
                <span class="token punctuation">(</span>
                    uniswappyFee
                    <span class="token operator">*</span> secondPairData<span class="token punctuation">.</span>reserve0
                    <span class="token operator">*</span> <span class="token number">1000</span>
                <span class="token punctuation">)</span>
                <span class="token operator">+</span> <span class="token punctuation">(</span>
                    uniswappyFee
                    <span class="token operator">*</span> uniswappyFee
                    <span class="token operator">*</span> firstPairData<span class="token punctuation">.</span>reserve0
                <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> denominator<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// æ ¹æ®æ± å­ä¿¡æ¯è¿›è¡Œè½¬æ¢</span>
    <span class="token keyword">function</span> <span class="token function">getPairData</span><span class="token punctuation">(</span>IUniswapV2Pair pair<span class="token punctuation">)</span> <span class="token keyword">private</span> view <span class="token function">returns</span> <span class="token punctuation">(</span>IPairReserves<span class="token punctuation">.</span>PairReserves memory<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">(</span>uint256 reserve0<span class="token punctuation">,</span> uint256 reserve1<span class="token punctuation">,</span> <span class="token punctuation">)</span> <span class="token operator">=</span> pair<span class="token punctuation">.</span><span class="token function">getReserves</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;pair:&quot;</span><span class="token punctuation">,</span> <span class="token function">address</span><span class="token punctuation">(</span>pair<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;reserve0:&quot;</span><span class="token punctuation">,</span>reserve0<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;reserve1:&quot;</span><span class="token punctuation">,</span> reserve1<span class="token punctuation">)</span><span class="token punctuation">;</span>

        uint256 price<span class="token punctuation">;</span>

        bool isWETHZero <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>pair<span class="token punctuation">.</span><span class="token function">token0</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">address</span><span class="token punctuation">(</span><span class="token constant">WETH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            price <span class="token operator">=</span> reserve1 <span class="token operator">*</span> <span class="token number">1e18</span> <span class="token operator">/</span> reserve0<span class="token punctuation">;</span>
            isWETHZero <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            price <span class="token operator">=</span> reserve0 <span class="token operator">*</span> <span class="token number">1e18</span> <span class="token operator">/</span> reserve1<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token keyword">return</span> IPairReserves<span class="token punctuation">.</span><span class="token function">PairReserves</span><span class="token punctuation">(</span>reserve0<span class="token punctuation">,</span> reserve1<span class="token punctuation">,</span> price<span class="token punctuation">,</span> isWETHZero<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// åŠŸèƒ½æ–¹æ³•</span>
    <span class="token keyword">function</span> <span class="token function">sqrt</span><span class="token punctuation">(</span>uint256 x<span class="token punctuation">)</span> <span class="token keyword">private</span> pure <span class="token function">returns</span> <span class="token punctuation">(</span>uint256<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
        uint256 z <span class="token operator">=</span> <span class="token punctuation">(</span>x <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        uint256 y <span class="token operator">=</span> x<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span>z <span class="token operator">&lt;</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            y <span class="token operator">=</span> z<span class="token punctuation">;</span>
            z <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span>x <span class="token operator">/</span> z<span class="token punctuation">)</span> <span class="token operator">+</span> z<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> y<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token keyword">function</span> <span class="token function">getAmountOut</span><span class="token punctuation">(</span>uint amountIn<span class="token punctuation">,</span>
        uint reserveIn<span class="token punctuation">,</span>
        uint reserveOut
    <span class="token punctuation">)</span> internal pure <span class="token function">returns</span> <span class="token punctuation">(</span>uint amountOut<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        uint amountInWithFee <span class="token operator">=</span> amountIn <span class="token operator">*</span> <span class="token number">997</span><span class="token punctuation">;</span>
        uint numerator <span class="token operator">=</span> amountInWithFee <span class="token operator">*</span> reserveOut<span class="token punctuation">;</span>
        uint denominator <span class="token operator">=</span> reserveIn <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">+</span> amountInWithFee<span class="token punctuation">;</span>
        amountOut <span class="token operator">=</span> numerator <span class="token operator">/</span> denominator<span class="token punctuation">;</span>
        <span class="token keyword">return</span> amountOut<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// ä¼ è¾“ä»£å¸</span>
    <span class="token keyword">function</span> <span class="token function">call</span><span class="token punctuation">(</span>address payable _to<span class="token punctuation">,</span> uint256 _value<span class="token punctuation">,</span> bytes memory _data<span class="token punctuation">)</span> external onlyOwner <span class="token punctuation">{</span>
        <span class="token punctuation">(</span>bool success<span class="token punctuation">,</span> <span class="token punctuation">)</span> <span class="token operator">=</span> _to<span class="token punctuation">.</span>call<span class="token punctuation">{</span>value<span class="token operator">:</span> _value<span class="token punctuation">}</span><span class="token punctuation">(</span>_data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>success<span class="token punctuation">,</span> <span class="token string">&quot;External call failed&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>


    <span class="token function">receive</span><span class="token punctuation">(</span><span class="token punctuation">)</span> external payable <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“" aria-hidden="true">#</a> æ€»ç»“</h2><ol><li>ä¸‰è§’å¥—åˆ©ï¼Ÿeth - A - B - eth</li><li>uniswap v2 - v3 ? v3- v3?</li><li>å¦‚ä½•æé«˜è°ƒç”¨æ­£ç¡®ç‡ï¼Œå³æˆåŠŸåå¯ä»¥è¦†ç›–<code>gas</code>éƒ¨åˆ†</li></ol></div><!----><footer class="page-meta"><div class="meta-item edit-link"><a href="https://github.com/rfk1118/edit/main/docs/web3/arb.md" rel="noopener noreferrer" target="_blank" aria-label="ç¼–è¾‘æ­¤é¡µ" class="nav-link label"><!--[--><svg xmlns="http://www.w3.org/2000/svg" class="icon edit-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="edit icon"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></svg><!--]-->ç¼–è¾‘æ­¤é¡µ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div><div class="meta-item git-info"><div class="update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: rfk1118@gmail.com">renfakai</span><!--]--><!--]--></div></div></footer><nav class="page-nav"><a href="/web3/disperse.html" class="nav-link prev" aria-label="Disperse"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><!---->Disperse</div></a><a href="/web3/LIQUIDITY.html" class="nav-link next" aria-label="æµåŠ¨æ€§è·å–"><div class="hint">ä¸‹ä¸€é¡µ<span class="arrow end"></span></div><div class="link">æµåŠ¨æ€§è·å–<!----></div></a></nav><!----><!----><!--]--></main><!--]--><footer class="footer-wrapper"><!----><!----></footer></div><!--]--><!--]--><!----><!----><!--]--></div>
    <script type="module" src="/assets/app-ef31af74.js" defer></script>
  </body>
</html>
